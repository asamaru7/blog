<!DOCTYPE html>
<html>

<head>
	<title>CentOS 7 firewalld vs iptables</title>
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<meta name="author" content="유영재">
	<meta name="keywords" content="CentOS 7 firewalld vs iptables,linux,이 세상에 하나는 남기고 가자"/>
	<meta name="description" content="CentOS 7 firewalld vs iptables,linux,CentOS 7부터 방화벽으로 iptables를 사용하지 않고 firewalld를 사용한다. /etc/sysconfig/iptables 파일도 존재하지 않는다. 따라서 firewall-cmd를 사용해서 방화벽을 설정해야 한다(x windows에서는 firewall-config를 사..."/>

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- http://opengraphprotocol.org/ -->
	<meta name="twitter:card" content="summary_large_image">
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://blog.asamaru.net/2015/10/16/centos-7-firewalld/">
	<meta property="og:title" content="CentOS 7 firewalld vs iptables">
	

	<link rel="canonical" href="https://blog.asamaru.net/2015/10/16/centos-7-firewalld/"/>
	<link rel="shortcut icon" type="image/x-icon" media="screen" href="https://blog.asamaru.net/favicon.ico"/>
	<link rel="alternate" type="application/rss+xml" title="이 세상에 하나는 남기고 가자" href="https://blog.asamaru.net/atom.xml"/>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="https://blog.asamaru.net/static/css/style.css"/>
	<link rel="stylesheet" type="text/css" href="https://blog.asamaru.net/static/css/highlight.css"/>

	
	<link rel="stylesheet" type="text/css" href="https://blog.asamaru.net/static/css/post.css"/>
	
	

	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
					(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-65749108-2', 'auto');
		ga('send', 'pageview');

	</script>
</head>


<body>
<div class="main">

	<nav class="navbar navbar-default" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" title="toggle navbar" data-toggle="collapse" data-target=".navbar-collapse">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">이 세상에 하나는 남기고 가자</a>
		</div>

		<div class="navbar-collapse collapse">
			
			<ul class="nav navbar-nav">
				<li class="active">
				<a rel="index" href="/">Blog</a>
				</li>
				<li >
				<a href="/archives/">Archives</a>
				</li>
			</ul>
			<ul class="nav navbar-nav navbar-right">
				<li>
					<a class="subscribe-rss" href="https://blog.asamaru.net/atom.xml" title="subscribe via RSS">
						<span class="visible-xs">RSS</span>
						<img class="hidden-xs" src="/static/img/rss.png" alt="RSS">
					</a>
				</li>
			</ul>
			
			<!-- <form class="navbar-form navbar-right" action="http://www.google.co.kr" id="cse-search-box" target="_blank">
			  <div class="form-group">
			    <input type="hidden" name="cx" value="partner-pub-8163803188491150:6044663021" />
			    <input type="hidden" name="ie" value="UTF-8" />
			    <input type="text" name="q" class="form-control" />
			    <input type="submit" name="sa" value="&#xac80;&#xc0c9;" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.co.kr/coop/cse/brand?form=cse-search-box&amp;lang=ko"></script> -->
			<form class="navbar-form navbar-right" action="https://www.google.com/search" method="GET">
				<input type="hidden" name="sitesearch" value="https://blog.asamaru.net">
				<div class="form-group">
					<input class="form-control" type="text" name="q" placeholder="Search">
				</div>
			</form>
			
		</div>
	</div>
</nav>


	<div class="container">
		<div class="row">
	<div class="content col-lg-9">
		<div class="sheet post">
			<header>
				<h2>CentOS 7 firewalld vs iptables</h2>
				<p class="post-meta">
					<!--<span class="glyphicon glyphicon-calendar"></span>--> 2015.10.16.
					
					&nbsp;&nbsp;&nbsp;
					<span>
						<a href="https://blog.asamaru.net/category/linux/"><span class="glyphicon glyphicon-list"></span>&nbsp;linux</a>
					</span>
					<span>
                </span>
				</p>
			</header>
			<hr class="boundary">
			<article>
				<!-- Topic of Contents -->
				<!--
								<section class="panel panel-default cToc">
									<div class="panel-heading">
										<h3 class="panel-title">Topic of Contents</h3>
									</div>
									<ul class="list-group">
										<li class="list-group-item toc">
										</li>
									</ul>
								</section>
				-->

				<p>CentOS 7부터 방화벽으로 iptables를 사용하지 않고 firewalld를 사용한다. <code class="highlighter-rouge">/etc/sysconfig/iptables</code> 파일도 존재하지 않는다. 따라서 <code class="highlighter-rouge">firewall-cmd</code>를 사용해서 방화벽을 설정해야 한다(x windows에서는 firewall-config를 사용한다고하나 콘솔만 사용해봐서 firewall-config는 어떻게 생겼는지 모르겠다).</p>

<p><a href="https://access.redhat.com/documentation/ko-KR/Red_Hat_Enterprise_Linux/7/html/Migration_Planning_Guide/ch04s11.html#idp7905344">Redhat Products &amp; Servies의 4.11. 보안 및 액세스 제어</a>에 아래와 같이 설명되어 있다.</p>

<blockquote>
  <p><strong>4.11.1. 새로운 방화벽 (firewalld)</strong></p>

  <p>Red Hat Enterprise Linux 6에서 방화벽 기능은 iptables 유틸리티에 의해 제공되어 명령행이나 그래픽 설정 도구, system-config-firewall에서 설정되었습니다. Red Hat Enterprise Linux 7에서 방화벽 기능은 iptables에 의해 제공되지만 관리자는 동적 방화벽 데몬, firewalld, 설정 도구를 통해 iptables와 상호 작용합니다. 설정 도구에는 firewall-config, firewall-cmd, firewall-applet이 있으며 이는 Red Hat Enterprise Linux 7 기본값 설치에 포함되어 있지 않습니다.</p>

  <p>firewalld는 동적이기 때문에 언제든지 설정을 변경할 수 있고 바로 실행됩니다. 방화벽을 다시 로딩할 필요가 없으므로 기존 네트워크 연결에서 의도하지 않은 중단이 발생하지 않습니다.</p>
</blockquote>

<blockquote>
  <p>Red Hat Enterprise Linux 6와 7 간의 방화벽에서의 주요 차이점은 다음과 같습니다:</p>

  <ul>
    <li>
      <p>방화벽 설정에 대한 자세한 내용은 /etc/sysconfig/iptables에 저장되어 있지 않고 이 파일이 존재하지도 않습니다. 대신 설정 상세 정보는 /usr/lib/firewalld 및 /etc/firewalld 디렉토리에 있는 다양한 파일에 저장됩니다.</p>
    </li>
    <li>
      <p>Red Hat Enterprise Linux 6의 방화벽 시스템에서는 설정 변경 사항이 있을 때 마다 모든 규칙이 삭제되고 다시 적용되어 firewalld는 설정 차이만을 적용합니다. 그 결과 firewalld는 기존 연결을 중단하지 않고 런타임 동안 설정을 변경할 수 있습니다.</p>
    </li>
  </ul>
</blockquote>

<p>또한 <a href="http://www.slideshare.net/sukkim737/oracle-enterprise-linux-new-featurefirewalld">firewalld concept and configuration</a>에 보면 “firewalld의 필요성”에 대해 설명하고 있다(6 page). 편의를 위해 해당 부분만 아래에 안내한다.</p>

<blockquote>
  <p><strong>firewalld 의 필요성</strong></p>

  <ul>
    <li>기존 iptables의 한계</li>
    <li>룰 변경시 서비스 중지 및 설정 변경</li>
    <li>오픈스택이나 KVM과 같은 가상화 호스트에서는 네트워크 변 화가 수시로 발생되므로 필터링 정책에 변경이 필요</li>
    <li>응용프로그램 자체에서 필터링 정책을 구성하는 경우 iptables 정책과 충돌되는 등의 문제 야기</li>
    <li>firewalld가 필요한 이유?
      <ul>
        <li>KVM , openstack 과 같은 가상화, 클라우드 환경하에서의 필 터링 정책 동적 추가 가능</li>
        <li>DBUS API를 통한 정보 공유를 통해 정책 충돌 문제 해결</li>
      </ul>
    </li>
    <li>DBUS란? 어플리케이션간의 통신을 지원하는 인터페이스</li>
  </ul>
</blockquote>

<p>마지막으로 <a href="https://www.linux.co.kr/home2/board/subbs/board.php?bo_table=lecture&amp;wr_id=1860&amp;sca=&amp;page=0">Doly의 CentOS7 강좌30 12. 네트워크 보안설정 12.2 iptables 서비스 (1/3)</a>에서는 아래와 같이 안내하고 있다.</p>

<blockquote>
  <p><strong>12.2. iptables 서비스</strong></p>

  <p>firewalld는 분명 CentOS7의 아주 혁신적인 기능중의 하나이다. 하지만 필자는 본 서적을 집필하면서 인터페이스가 편리 하나 많은 부분에서 부족함을 느꼈다. 특히 소스IP를 명시하는 부분이 명확하지 않다. 방화벽의 기본은 출발지 IP, 프로토콜, 포트 도착지 IP, 프로토콜, 포트를 기본으로 방화벽 규칙을 만들어간다. 하지만, firewalld는 출발지 IP와 목적지 IP에 대한 정의가 명확하지 않다. 리눅스 스킬이 중급 이상이라면 이러한 이유로 firewalld 서비스를 제거하고 예전 iptables 서비스로 돌아가길 권장하고 싶다.</p>
</blockquote>

<p>사실 “소스IP를 명시하는 부분이 명확하지 않다.” 라는 부분은 글쓴이의 정확한 의도를 알 수 없어 단언하기는 힘들지만 틀린 부분이 있을 수 있다고 생각한다. firewalld를 사용하더라도 소스 IP를 지정할 수 없는 것은 아니다.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>firewall-cmd --permanent --zone<span class="o">=</span>public --add-rich-rule<span class="o">=</span><span class="s1">'rule family="ipv4" source address="1.2.3.4/32" port protocol="tcp" port="80" accept'</span>
</code></pre>
</div>

<p>위 명령에서 보는 것과 같이 <code class="highlighter-rouge">rich-rule</code>를 사용해서 소스 IP를 지정할 수 있다. 그리고 지정된 내역을 보는 방법은 <code class="highlighter-rouge">firewall-cmd</code>을 사용하면 되지만 개인적으로는 <code class="highlighter-rouge">cat /etc/firewalld/zones/public.xml</code>를 사용해서 확인하는게 더 편한 것 같다. 사실은 아직 <code class="highlighter-rouge">firewall-cmd</code>를 능숙하게 사용하지를 못해서 어떻게하면 보기 쉽게 나오는지 잘 모르겠다(몇가지 명령을 시도해 봤는데 내용이 너무 많이 나온다.).</p>

<p>결론적으로 <strong>무조건 firewalld를 사용해야 하는 것은 아니다.</strong> firewalld를 중지시키고 iptables를 설치해서 기존처럼 관리하는 것도 가능하다. 아래의 명령을 실행하면 된다.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>systemctl stop firewalld
<span class="gp">$ </span>systemctl mask firewalld

<span class="gp">$ </span>yum install iptables-services
<span class="gp">$ </span>systemctl <span class="nb">enable </span>iptables

<span class="gp">$ </span>service iptables save
</code></pre>
</div>

<p><strong>firewalld를 사용할지 iptables를 사용할지는 자신의 선택이다.</strong></p>

<p>현재 시점에서의 내 생각은 firewalld로 이전하는 것이다. 아직은 사용이 익숙치 않아 정확한 이전이 가능할지는 모르겠다. 이제부터 방법을 하나씩 찾아봐야 할 것이다. 하지만 Redhat에서 설명하는 것 처럼 결국은 iptables와 상호 작용하는 형태라고는 해도 접근 지점이 firewalld로 변경되었으며 앞으로도 그럴 것이기 때문이다. 주로 개발업무를 하다보니 서버를 전문적으로 운영했다고는 할 수 없으나 나름의 경험으로 볼 때 일시적인 대응은 결국 대세를 따르도록 변하게 된다.</p>

			</article>
			<hr class="boundary">
		</div>

		<!-- adsense -->
		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<!-- 블로그 하단 -->
		<ins class="adsbygoogle"
			 style="display:block; margin-bottom:20px;"
			 data-ad-client="ca-pub-8163803188491150"
			 data-ad-slot="7841851420"
			 data-ad-format="auto"></ins>
		<script>
			(adsbygoogle = window.adsbygoogle || []).push({});
		</script>
		<!-- adsense -->

		<div class="pad-min"></div>
		<div id="post-comment" class="sheet post">
			<div id="disqus_thread"></div>
		</div>
	</div>
	<div class="content-navigation col-lg-3">
		<!-- I made it -->
		<section class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">I made it</h3>
			</div>
			<ul class="list-group">
				<li class="list-group-item"><a href="http://sprite.asamaru.net/" target="_blank">Sprite CSS/Image</a></li>
				<li class="list-group-item"><a href="http://loan.asamaru.net/" target="_blank">대출이자계산기</a></li>
				<li class="list-group-item"><a href="http://bookmarklet.asamaru.net/" target="_blank">북마클릿 생성기</a></li>
			</ul>
		</section>

		<!-- Categories -->
		
		
		<section class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Categories</h3>
			</div>
			<ul class="list-group">
				
				<li class="list-group-item"><a href="/category/thinking/">Thinking <span class="badge">3</span></a></li>
				
				<li class="list-group-item"><a href="/category/osx/">Osx <span class="badge">6</span></a></li>
				
				<li class="list-group-item"><a href="/category/programming/">Programming <span class="badge">1</span></a></li>
				
				<li class="list-group-item"><a href="/category/css/">Css <span class="badge">3</span></a></li>
				
				<li class="list-group-item"><a href="/category/js/">Js <span class="badge">8</span></a></li>
				
				<li class="list-group-item"><a href="/category/android/">Android <span class="badge">53</span></a></li>
				
				<li class="list-group-item"><a href="/category/octopress/">Octopress <span class="badge">8</span></a></li>
				
				<li class="list-group-item"><a href="/category/ios/">Ios <span class="badge">18</span></a></li>
				
				<li class="list-group-item"><a href="/category/php/">Php <span class="badge">21</span></a></li>
				
				<li class="list-group-item"><a href="/category/java/">Java <span class="badge">5</span></a></li>
				
				<li class="list-group-item"><a href="/category/db/">Db <span class="badge">6</span></a></li>
				
				<li class="list-group-item"><a href="/category/html/">Html <span class="badge">1</span></a></li>
				
				<li class="list-group-item"><a href="/category/git/">Git <span class="badge">7</span></a></li>
				
				<li class="list-group-item"><a href="/category/blog/">Blog <span class="badge">1</span></a></li>
				
				<li class="list-group-item"><a href="/category/tip/">Tip <span class="badge">13</span></a></li>
				
				<li class="list-group-item"><a href="/category/linux/">Linux <span class="badge">26</span></a></li>
				
				<li class="list-group-item"><a href="/category/swift/">Swift <span class="badge">6</span></a></li>
				
				<li class="list-group-item"><a href="/category/iOS/">Ios <span class="badge">2</span></a></li>
				
				<li class="list-group-item"><a href="/category/vagrant/">Vagrant <span class="badge">5</span></a></li>
				
				<li class="list-group-item"><a href="/category/jekyll/">Jekyll <span class="badge">2</span></a></li>
				
				<li class="list-group-item"><a href="/category/flash/">Flash <span class="badge">1</span></a></li>
				
			</ul>
		</section>
		
		

		<!-- Tags -->
		
		
		

		<!-- adsense -->
		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<!-- 블로그 우측 -->
		<ins class="adsbygoogle"
			 style="display:block; margin-bottom:20px;"
			 data-ad-client="ca-pub-8163803188491150"
			 data-ad-slot="1934918622"
			 data-ad-format="auto"></ins>
		<script>
			(adsbygoogle = window.adsbygoogle || []).push({});
		</script>
		<!-- adsense -->

		<!-- Related -->
		

		

		
		<section class="panel panel-default dRelatedPosts">
			<div class="panel-heading">
				<h3 class="panel-title">Related</h3>
			</div>
			<ul class="list-group">
				
				<li class="list-group-item"><a href="https://blog.asamaru.net/2016/10/26/nginx-504-error/">nginx 504 Gateway Time-out 오류</a></li>
				
				<li class="list-group-item"><a href="https://blog.asamaru.net/2016/04/26/efficiently-delete-large-directory-containing-thousands-of-files/">linux에서 대량의 파일을 보다 빠르게 지우기</a></li>
				
				<li class="list-group-item"><a href="https://blog.asamaru.net/2016/04/14/how-to-chmod-all-directories-or-files/">chmod로 권한 변경시 디렉토리(또는 파일)만 적용하기</a></li>
				
				<li class="list-group-item"><a href="https://blog.asamaru.net/2016/04/07/how-to-protect-ssh-with-fail2ban-on-centos-6-7/">SSH 무작위 로그인 시도 막기(With Fail2Ban on CentOS 6/7 + selinux)</a></li>
				
				<li class="list-group-item"><a href="https://blog.asamaru.net/2016/04/06/yum-error-xz-compression-not-available/">yum 실행시 Error: xz compression not available 오류가 날 경우</a></li>
				
			</ul>
		</section>
		

		<section class="panel panel-default">
			<style>
				#google_translate_country { text-align:center; padding-top:5px; }
				#google_translate_element > div { text-align:center; padding:5px 0; }
				#google_translate_element > div > div { display:inline-block; *display:inline; *zoom:1; margin-right:10px; }
			</style>
			<div id="google_translate_country">
				<a href="#googtrans(ko|en)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/English.gif?w=660" alt="English"/></a>
				<!-- <a href="#googtrans(ko|ko)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/Korean.gif?w=660" alt="Korean"/></a> -->
				<a href="#googtrans(ko|zh-CN)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/Chinese.gif?w=660" alt="Chinese"/></a>
				<a href="#googtrans(ko|ja)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/Japanese.gif?w=660" alt="Japanese"/></a>
				<a href="#googtrans(ko|fr)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/French.gif?w=660" alt="French"/></a>
				<a href="#googtrans(ko|de)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/German.gif?w=660" alt="German"/></a>
				<a href="#googtrans(ko|it)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/Italian.gif?w=660" alt="Italian"/></a>
			</div>
			<div id="google_translate_element"></div>
			<script type="text/javascript">
				function googleTranslateElementInit() {
					new google.translate.TranslateElement({pageLanguage: 'ko'}, 'google_translate_element');
				}
			</script>
			<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
		</section>
	</div>
</div>


		
		<div id="disqus_thread"></div>
		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
			var disqus_shortname = 'asamaru7'; // required: replace example with your forum shortname
			// var disqus_developer = 1; // Comment out when the site is live
			var disqus_identifier = "/2015/10/16/centos-7-firewalld/";

			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var dsq = document.createElement('script');
				dsq.type = 'text/javascript';
				dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>
		<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
		
	</div>

	<div class="page-scrollTop" data-toggle="tooltip" data-placement="top" title="Top">
		<a href="javascript:void(0);">
			<div class="arrow"></div>
			<div class="stick"></div>
		</a>
	</div>
</div>

<footer class="footnote footnote-tiffany">
	<div class="container">
		<a class="foot-item" href="mailto:asamaru@asamaru.net" target="_blank"><img src="/static/img/bottom-email.png" alt="Email"></a>
		<a class="foot-item" href="https://github.com/asamaru7" target="_blank"><img src="/static/img/bottom-github.png" alt="Github"></a>
		<a class="foot-item" href="https://blog.asamaru.net/atom.xml" target="_blank"><img src="/static/img/bottom-rss.png" alt="RSS"></a>
		&nbsp;
		<a href="https://blog.asamaru.net"><span class="word-keep">&copy; 유영재</span></a>
	</div>
</footer>


<div class="scriptHub">
	<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
	<script type="text/javascript" src="https://blog.asamaru.net/static/js/script.js"></script>

	
	<script type="text/javascript" src="https://blog.asamaru.net/static/js/post.js"></script>
	
	
</div>



</body>
</html>
