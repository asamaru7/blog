<!DOCTYPE html>
<html>

<head>
	<title>mysql_secure_installation 자동화</title>
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<meta name="author" content="유영재">
	<meta name="keywords" content="mysql_secure_installation 자동화,linux,이 세상에 하나는 남기고 가자"/>
	<meta name="description" content="mysql_secure_installation 자동화,linux,이전 글 MariaDB 최신 버전 설치(yum) - CentOS 7에서 MariaDB를 설치하면서 mysql_secure_installation 명령을 자동화하는 부분을 언급했었다. 이 글에서는 이를 설명하려고 한다. 우선 바로 만들어둔 bash shell script를 보자.my..."/>

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- http://opengraphprotocol.org/ -->
	<meta name="twitter:card" content="summary_large_image">
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://blog.asamaru.net/2015/12/04/mysql-secure-installation-automation/">
	<meta property="og:title" content="mysql_secure_installation 자동화">
	

	<link rel="canonical" href="https://blog.asamaru.net/2015/12/04/mysql-secure-installation-automation/"/>
	<link rel="shortcut icon" type="image/x-icon" media="screen" href="https://blog.asamaru.net/favicon.ico"/>
	<link rel="alternate" type="application/rss+xml" title="이 세상에 하나는 남기고 가자" href="https://blog.asamaru.net/atom.xml"/>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="https://blog.asamaru.net/static/css/style.css"/>
	<link rel="stylesheet" type="text/css" href="https://blog.asamaru.net/static/css/highlight.css"/>

	
	<link rel="stylesheet" type="text/css" href="https://blog.asamaru.net/static/css/post.css"/>
	
	

	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
					(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-65749108-2', 'auto');
		ga('send', 'pageview');

	</script>
</head>


<body>
<div class="main">

	<nav class="navbar navbar-default" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" title="toggle navbar" data-toggle="collapse" data-target=".navbar-collapse">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">이 세상에 하나는 남기고 가자</a>
		</div>

		<div class="navbar-collapse collapse">
			
			<ul class="nav navbar-nav">
				<li class="active">
				<a rel="index" href="/">Blog</a>
				</li>
				<li >
				<a href="/archives/">Archives</a>
				</li>
			</ul>
			<ul class="nav navbar-nav navbar-right">
				<li>
					<a class="subscribe-rss" href="https://blog.asamaru.net/atom.xml" title="subscribe via RSS">
						<span class="visible-xs">RSS</span>
						<img class="hidden-xs" src="/static/img/rss.png" alt="RSS">
					</a>
				</li>
			</ul>
			
			<!-- <form class="navbar-form navbar-right" action="http://www.google.co.kr" id="cse-search-box" target="_blank">
			  <div class="form-group">
			    <input type="hidden" name="cx" value="partner-pub-8163803188491150:6044663021" />
			    <input type="hidden" name="ie" value="UTF-8" />
			    <input type="text" name="q" class="form-control" />
			    <input type="submit" name="sa" value="&#xac80;&#xc0c9;" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.co.kr/coop/cse/brand?form=cse-search-box&amp;lang=ko"></script> -->
			<form class="navbar-form navbar-right" action="https://www.google.com/search" method="GET">
				<input type="hidden" name="sitesearch" value="https://blog.asamaru.net">
				<div class="form-group">
					<input class="form-control" type="text" name="q" placeholder="Search">
				</div>
			</form>
			
		</div>
	</div>
</nav>


	<div class="container">
		<div class="row">
	<div class="content col-lg-9">
		<div class="sheet post">
			<header>
				<h2>mysql_secure_installation 자동화</h2>
				<p class="post-meta">
					<!--<span class="glyphicon glyphicon-calendar"></span>--> 2015.12.04.
					
					&nbsp;&nbsp;&nbsp;
					<span>
						<a href="https://blog.asamaru.net/category/linux/"><span class="glyphicon glyphicon-list"></span>&nbsp;linux</a>
					</span>
					<span>
                </span>
				</p>
			</header>
			<hr class="boundary">
			<article>
				<!-- Topic of Contents -->
				<!--
								<section class="panel panel-default cToc">
									<div class="panel-heading">
										<h3 class="panel-title">Topic of Contents</h3>
									</div>
									<ul class="list-group">
										<li class="list-group-item toc">
										</li>
									</ul>
								</section>
				-->

				<p>이전 글 <a href="2015/12/04/installing-mariadb-on-centos-7/">MariaDB 최신 버전 설치(yum) - CentOS 7</a>에서 MariaDB를 설치하면서 <code>mysql_secure_installation</code> 명령을 자동화하는 부분을 언급했었다. 이 글에서는 이를 설명하려고 한다. 우선 바로 만들어둔 bash shell script를 보자.</p>

<p><strong>mysql_secure_installation_automation.sh</strong></p>

<figure class='code'><div class="highlight notranslate"><pre><code class="language-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/bin/bash</span>

<span class="c"># https://gist.github.com/Mins/4602864</span>

yum -y install expect

<span class="c"># Not required in actual script</span>
<span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>

<span class="nv">SECURE_MYSQL</span><span class="o">=</span><span class="k">$(</span>expect -c <span class="s2">&quot;</span>
<span class="s2">set timeout 3</span>
<span class="s2">spawn mysql_secure_installation</span>
<span class="s2">expect \&quot;Enter current password for root (enter for none):\&quot;</span>
<span class="s2">send \&quot;$MYSQL\r\&quot;</span>
<span class="s2">expect \&quot;Change the root password?\&quot;</span>
<span class="s2">send \&quot;n\r\&quot;</span>
<span class="s2">expect \&quot;Remove anonymous users?\&quot;</span>
<span class="s2">send \&quot;y\r\&quot;</span>
<span class="s2">expect \&quot;Disallow root login remotely?\&quot;</span>
<span class="s2">send \&quot;y\r\&quot;</span>
<span class="s2">expect \&quot;Remove test database and access to it?\&quot;</span>
<span class="s2">send \&quot;y\r\&quot;</span>
<span class="s2">expect \&quot;Reload privilege tables now?\&quot;</span>
<span class="s2">send \&quot;y\r\&quot;</span>
<span class="s2">expect eof</span>
<span class="s2">&quot;</span><span class="k">)</span>

<span class="nb">echo</span> <span class="s2">&quot;$SECURE_MYSQL&quot;</span>
</pre></div>
</td></tr></table></code></pre></div></figure>

<p>이 스크립트는 <a href="https://gist.github.com/Mins/4602864">mysql_secure_installation automation</a> 스크립트를 참고하여 CentOS에 맞게 조금 수정한 것이다.</p>

<p>위 스크립트를 mysql_secure_installation_automation.sh 파일로 저장했다면 아래와 같이 실행하면 된다.</p>

<figure class='code'><div class="highlight notranslate"><pre><code class="language-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$ </span>chmod <span class="m">700</span> mysql_secure_installation_automation.sh
<span class="nv">$ </span>./mysql_secure_installation_automation.sh
</pre></div>
</td></tr></table></code></pre></div></figure>

<p>특별히 설명할 것도 없지만 간략하게나마 원리를 설명하자면 <code>expect</code>라는 도구를 사용해서 사용자 입력을 대신하도록 하는 것이다(이후에 알게되었지만 <a href="http://sourceforge.net/projects/sshpass/">sshpass</a>라는 것이 있어서 expect를 사용하지 않아도 된다. 아니면 <a href="/2016/01/26/ssh-login-without-password/">ssh 비밀번호 없이 로그인하기</a>에서 쓴 것처럼 다른 방법도 있다). 이를 응용하면 <code>mysql_secure_installation</code> 외에도 여러가지 상황에 적용할 수 있다. 나의 경우는 <code>expect</code>를 이용해서 ssh 비밀번호 자동 입력 기능을 만들어 사용하고 있었다. 사실 ssh의 경우는 key를 등록하는 방식으로 비밀번호 없이 로그인이 가능하고 비밀번호를 외부로 노출하는 것이 보안상 문제가 있지만 간단하게 접속이 필요하고 보안상의 이슈가 없는 곳에서 유용하게 사용하고 있다.</p>

			</article>
			<hr class="boundary">
		</div>

		<!-- adsense -->
		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<!-- 블로그 하단 -->
		<ins class="adsbygoogle"
			 style="display:block; margin-bottom:20px;"
			 data-ad-client="ca-pub-8163803188491150"
			 data-ad-slot="7841851420"
			 data-ad-format="auto"></ins>
		<script>
			(adsbygoogle = window.adsbygoogle || []).push({});
		</script>
		<!-- adsense -->

		<div class="pad-min"></div>
		<div id="post-comment" class="sheet post">
			<div id="disqus_thread"></div>
		</div>
	</div>
	<div class="content-navigation col-lg-3">
		<!-- I made it -->
		<section class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">I made it</h3>
			</div>
			<ul class="list-group">
				<li class="list-group-item"><a href="http://sprite.asamaru.net/" target="_blank">Sprite CSS/Image</a></li>
				<li class="list-group-item"><a href="http://loan.asamaru.net/" target="_blank">대출이자계산기</a></li>
				<li class="list-group-item"><a href="http://bookmarklet.asamaru.net/" target="_blank">북마클릿 생성기</a></li>
			</ul>
		</section>

		<!-- Categories -->
		
		
		<section class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Categories</h3>
			</div>
			<ul class="list-group">
				
				<li class="list-group-item"><a href="/category/thinking/">Thinking <span class="badge">3</span></a></li>
				
				<li class="list-group-item"><a href="/category/osx/">Osx <span class="badge">4</span></a></li>
				
				<li class="list-group-item"><a href="/category/programming/">Programming <span class="badge">1</span></a></li>
				
				<li class="list-group-item"><a href="/category/css/">Css <span class="badge">3</span></a></li>
				
				<li class="list-group-item"><a href="/category/js/">Js <span class="badge">8</span></a></li>
				
				<li class="list-group-item"><a href="/category/android/">Android <span class="badge">46</span></a></li>
				
				<li class="list-group-item"><a href="/category/octopress/">Octopress <span class="badge">8</span></a></li>
				
				<li class="list-group-item"><a href="/category/ios/">Ios <span class="badge">18</span></a></li>
				
				<li class="list-group-item"><a href="/category/php/">Php <span class="badge">21</span></a></li>
				
				<li class="list-group-item"><a href="/category/java/">Java <span class="badge">5</span></a></li>
				
				<li class="list-group-item"><a href="/category/db/">Db <span class="badge">6</span></a></li>
				
				<li class="list-group-item"><a href="/category/html/">Html <span class="badge">1</span></a></li>
				
				<li class="list-group-item"><a href="/category/git/">Git <span class="badge">6</span></a></li>
				
				<li class="list-group-item"><a href="/category/blog/">Blog <span class="badge">1</span></a></li>
				
				<li class="list-group-item"><a href="/category/tip/">Tip <span class="badge">13</span></a></li>
				
				<li class="list-group-item"><a href="/category/linux/">Linux <span class="badge">25</span></a></li>
				
				<li class="list-group-item"><a href="/category/swift/">Swift <span class="badge">6</span></a></li>
				
				<li class="list-group-item"><a href="/category/iOS/">Ios <span class="badge">2</span></a></li>
				
				<li class="list-group-item"><a href="/category/vagrant/">Vagrant <span class="badge">5</span></a></li>
				
				<li class="list-group-item"><a href="/category/jekyll/">Jekyll <span class="badge">1</span></a></li>
				
			</ul>
		</section>
		
		

		<!-- Tags -->
		
		
		

		<!-- adsense -->
		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<!-- 블로그 우측 -->
		<ins class="adsbygoogle"
			 style="display:block; margin-bottom:20px;"
			 data-ad-client="ca-pub-8163803188491150"
			 data-ad-slot="1934918622"
			 data-ad-format="auto"></ins>
		<script>
			(adsbygoogle = window.adsbygoogle || []).push({});
		</script>
		<!-- adsense -->

		<!-- Related -->
		

		

		
		<section class="panel panel-default dRelatedPosts">
			<div class="panel-heading">
				<h3 class="panel-title">Related</h3>
			</div>
			<ul class="list-group">
				
				<li class="list-group-item"><a href="https://blog.asamaru.net/2016/04/26/efficiently-delete-large-directory-containing-thousands-of-files/">linux에서 대량의 파일을 보다 빠르게 지우기</a></li>
				
				<li class="list-group-item"><a href="https://blog.asamaru.net/2016/04/14/how-to-chmod-all-directories-or-files/">chmod로 권한 변경시 디렉토리(또는 파일)만 적용하기</a></li>
				
				<li class="list-group-item"><a href="https://blog.asamaru.net/2016/04/07/how-to-protect-ssh-with-fail2ban-on-centos-6-7/">SSH 무작위 로그인 시도 막기(With Fail2Ban on CentOS 6/7 + selinux)</a></li>
				
				<li class="list-group-item"><a href="https://blog.asamaru.net/2016/04/06/yum-error-xz-compression-not-available/">yum 실행시 Error: xz compression not available 오류가 날 경우</a></li>
				
				<li class="list-group-item"><a href="https://blog.asamaru.net/2016/03/18/iptables-port-forwarding/">iptables을 이용한 port forwarding</a></li>
				
			</ul>
		</section>
		

		<section class="panel panel-default">
			<style>
				#google_translate_country { text-align:center; padding-top:5px; }
				#google_translate_element > div { text-align:center; padding:5px 0; }
				#google_translate_element > div > div { display:inline-block; *display:inline; *zoom:1; margin-right:10px; }
			</style>
			<div id="google_translate_country">
				<a href="#googtrans(ko|en)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/English.gif?w=660" alt="English"/></a>
				<!-- <a href="#googtrans(ko|ko)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/Korean.gif?w=660" alt="Korean"/></a> -->
				<a href="#googtrans(ko|zh-CN)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/Chinese.gif?w=660" alt="Chinese"/></a>
				<a href="#googtrans(ko|ja)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/Japanese.gif?w=660" alt="Japanese"/></a>
				<a href="#googtrans(ko|fr)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/French.gif?w=660" alt="French"/></a>
				<a href="#googtrans(ko|de)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/German.gif?w=660" alt="German"/></a>
				<a href="#googtrans(ko|it)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/Italian.gif?w=660" alt="Italian"/></a>
			</div>
			<div id="google_translate_element"></div>
			<script type="text/javascript">
				function googleTranslateElementInit() {
					new google.translate.TranslateElement({pageLanguage: 'ko'}, 'google_translate_element');
				}
			</script>
			<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
		</section>
	</div>
</div>


		
		<div id="disqus_thread"></div>
		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
			var disqus_shortname = 'asamaru7'; // required: replace example with your forum shortname
			// var disqus_developer = 1; // Comment out when the site is live
			var disqus_identifier = "/2015/12/04/mysql-secure-installation-automation/";

			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var dsq = document.createElement('script');
				dsq.type = 'text/javascript';
				dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>
		<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
		
	</div>

	<div class="page-scrollTop" data-toggle="tooltip" data-placement="top" title="Top">
		<a href="javascript:void(0);">
			<div class="arrow"></div>
			<div class="stick"></div>
		</a>
	</div>
</div>

<footer class="footnote footnote-tiffany">
	<div class="container">
		<a class="foot-item" href="mailto:asamaru@asamaru.net" target="_blank"><img src="/static/img/bottom-email.png" alt="Email"></a>
		<a class="foot-item" href="https://github.com/asamaru7" target="_blank"><img src="/static/img/bottom-github.png" alt="Github"></a>
		<a class="foot-item" href="https://blog.asamaru.net/atom.xml" target="_blank"><img src="/static/img/bottom-rss.png" alt="RSS"></a>
		&nbsp;
		<a href="https://blog.asamaru.net"><span class="word-keep">&copy; 유영재</span></a>
	</div>
</footer>


<div class="scriptHub">
	<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
	<script type="text/javascript" src="https://blog.asamaru.net/static/js/script.js"></script>

	
	<script type="text/javascript" src="https://blog.asamaru.net/static/js/post.js"></script>
	
	
</div>



</body>
</html>
