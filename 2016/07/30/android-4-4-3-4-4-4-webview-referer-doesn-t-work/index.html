<!DOCTYPE html>
<html>

<head>
	<title>Android 4.4.3, 4.4.4 Webview Referer 오류 수정</title>
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<meta name="author" content="유영재">
	<meta name="keywords" content="Android 4.4.3, 4.4.4 Webview Referer 오류 수정,android,이 세상에 하나는 남기고 가자"/>
	<meta name="description" content="Android 4.4.3, 4.4.4 Webview Referer 오류 수정,android,안드로이드 WebView를 사용하면서 특정 페이지로의 접근시 Referer를 지정해서 넘기도록 처리해서 사용중인 앱이 있다. 그런데 테스트 도중 이상한 문제가 발생했다. Android 4.4.4에서만 지정한 Referer를 무시하고 넘기지 않는 것이다. 그래서 조금 찾아보니 아래와..."/>

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- http://opengraphprotocol.org/ -->
	<meta name="twitter:card" content="summary_large_image">
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://blog.asamaru.net/2016/07/30/android-4-4-3-4-4-4-webview-referer-doesn-t-work/">
	<meta property="og:title" content="Android 4.4.3, 4.4.4 Webview Referer 오류 수정">
	

	<link rel="canonical" href="https://blog.asamaru.net/2016/07/30/android-4-4-3-4-4-4-webview-referer-doesn-t-work/"/>
	<link rel="shortcut icon" type="image/x-icon" media="screen" href="https://blog.asamaru.net/favicon.ico"/>
	<link rel="alternate" type="application/rss+xml" title="이 세상에 하나는 남기고 가자" href="https://blog.asamaru.net/atom.xml"/>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="https://blog.asamaru.net/static/css/style.css"/>
	<link rel="stylesheet" type="text/css" href="https://blog.asamaru.net/static/css/highlight.css"/>

	
	<link rel="stylesheet" type="text/css" href="https://blog.asamaru.net/static/css/post.css"/>
	
	

	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
					(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-65749108-2', 'auto');
		ga('send', 'pageview');

	</script>
</head>


<body>
<div class="main">

	<nav class="navbar navbar-default" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" title="toggle navbar" data-toggle="collapse" data-target=".navbar-collapse">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">이 세상에 하나는 남기고 가자</a>
		</div>

		<div class="navbar-collapse collapse">
			
			<ul class="nav navbar-nav">
				<li class="active">
				<a rel="index" href="/">Blog</a>
				</li>
				<li >
				<a href="/archives/">Archives</a>
				</li>
			</ul>
			<ul class="nav navbar-nav navbar-right">
				<li>
					<a class="subscribe-rss" href="https://blog.asamaru.net/atom.xml" title="subscribe via RSS">
						<span class="visible-xs">RSS</span>
						<img class="hidden-xs" src="/static/img/rss.png" alt="RSS">
					</a>
				</li>
			</ul>
			
			<!-- <form class="navbar-form navbar-right" action="http://www.google.co.kr" id="cse-search-box" target="_blank">
			  <div class="form-group">
			    <input type="hidden" name="cx" value="partner-pub-8163803188491150:6044663021" />
			    <input type="hidden" name="ie" value="UTF-8" />
			    <input type="text" name="q" class="form-control" />
			    <input type="submit" name="sa" value="&#xac80;&#xc0c9;" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.co.kr/coop/cse/brand?form=cse-search-box&amp;lang=ko"></script> -->
			<form class="navbar-form navbar-right" action="https://www.google.com/search" method="GET">
				<input type="hidden" name="sitesearch" value="https://blog.asamaru.net">
				<div class="form-group">
					<input class="form-control" type="text" name="q" placeholder="Search">
				</div>
			</form>
			
		</div>
	</div>
</nav>


	<div class="container">
		<div class="row">
	<div class="content col-lg-9">
		<div class="sheet post">
			<header>
				<h2>Android 4.4.3, 4.4.4 Webview Referer 오류 수정</h2>
				<p class="post-meta">
					<!--<span class="glyphicon glyphicon-calendar"></span>--> 2016.07.30.
					
					&nbsp;&nbsp;&nbsp;
					<span>
						<a href="https://blog.asamaru.net/category/android/"><span class="glyphicon glyphicon-list"></span>&nbsp;android</a>
					</span>
					<span>
                </span>
				</p>
			</header>
			<hr class="boundary">
			<article>
				<!-- Topic of Contents -->
				<!--
								<section class="panel panel-default cToc">
									<div class="panel-heading">
										<h3 class="panel-title">Topic of Contents</h3>
									</div>
									<ul class="list-group">
										<li class="list-group-item toc">
										</li>
									</ul>
								</section>
				-->

				<p>안드로이드 WebView를 사용하면서 특정 페이지로의 접근시 Referer를 지정해서 넘기도록 처리해서 사용중인 앱이 있다. 그런데 테스트 도중 이상한 문제가 발생했다. Android 4.4.4에서만 지정한 Referer를 무시하고 넘기지 않는 것이다. 그래서 조금 찾아보니 아래와 같은 글들이 있었다.</p>

<ul>
  <li><a href="https://withwontae.wordpress.com/tag/webview/">Webview/UIWebview Header에 HTTP Referer 추가</a></li>
</ul>

<blockquote>
  <p>Android OS 4.4 이상의 단말에서는 Webview가 Chromium기반으로 변경되면서 Referer 추가해도 HTTP Header에 설정이 되지 않는 문제 발생( 이건 targetSDK 버전을 올려야 적용 )</p>

  <p>http://lapture.net/?p=2619</p>

  <p>버그라고들 이야기 하는데 버그가 아닌 것 같다. 보안상의 문제로 Chrominum Webview에서는 ‘Referer’ Key는 추가로 설정하지 못하도록 방지한 느낌이 든다.  ( 그냥 혼자만의 생각 – 혹시 아시는 분은 연락주세요 ㅜㅡㅜ )</p>
</blockquote>

<p>여기서는 버그가 아닌 보안 상의 문제로 보인다고 했지만 아래의 글을 보면 결국 버그인 것으로 보인다(보안 상 문제가 있다는 생각으로 개발자가 뺐을 수도 있겠지만…).</p>

<ul>
  <li><a href="https://code.google.com/p/android/issues/detail?id=72323">Nexus 5 referer string value is coming as null even if we pass it</a></li>
</ul>

<blockquote>
  <p>Project Member #2 sgu…@android.com
This is fixed and will be released in next version of Android. Thanks,</p>
</blockquote>

<p>이 글에서 보면 <code class="highlighter-rouge">Project Member</code>가 다음 버전에 수정하겠다는 답변을 달아 놓았다.
그리고 이글에서 보면 4.4.3과 4.4.4에서만 이 현상이 나타난다는 댓글도 있다. 모든 기기를 테스트할 수는 없으나 내가 확인한 기기들에서는 4.4.2는 이상이 없고 4.4.4에서는 실제로 이상이 있었다.</p>

<hr />

<p>결론은 4.4.3, 4.4.4 기기에서는 Referer를 사용할 수 없다는 것인데 이렇게 되면 이 방법을 아예 사용할 수가 없는 것과 같다. 그래서 방법을 찾아봤지만 해결책을 제시한 곳을 찾을 수 없었다.</p>

<p>하지만 수많은 테스트 결과 찾은 방법이 있어 아래에 공유한다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">extraHeaders</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">String</span> <span class="n">referer</span> <span class="o">=</span> <span class="s">"~~~"</span><span class="o">;</span>
<span class="n">extraHeaders</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"Referer"</span><span class="o">,</span> <span class="n">referer</span><span class="o">);</span>

<span class="k">if</span> <span class="o">((</span><span class="s">"4.4.3"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">os</span><span class="o">.</span><span class="na">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">RELEASE</span><span class="o">))</span>
		<span class="o">||</span> <span class="o">(</span><span class="s">"4.4.4"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">os</span><span class="o">.</span><span class="na">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">RELEASE</span><span class="o">)))</span> <span class="o">{</span>   <span class="c1">// 4.4.3 ~ 4.4.4 에서 Referer가 누락되는 문제를 수정하기 위함</span>
	<span class="n">extraHeaders</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"Referer "</span><span class="o">,</span> <span class="n">referer</span><span class="o">);</span>
<span class="o">}</span>

<span class="n">view</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">extraHeaders</span><span class="o">);</span>
</code></pre>
</div>

<p>아주 간단하다. “Referer” 대신 “Referer “를 사용하는 것이다. HTTP 프로토콜에서 Referer는 다음과 같은 형식이다. <code class="highlighter-rouge">Referer : ~~~</code> 따라서 Referer 뒤에 공백하나 더 들어가도 규칙엔 문제가 없으므로 정상 동작한다.</p>

<p>다행히 안드로이드에서 문자열을 trim하지 않고 비교하고 있어서 간단하게 해결된다. 개발자의 실수가 다행인 경우도 있을 수 있구나.</p>

			</article>
			<hr class="boundary">
		</div>

		<!-- adsense -->
		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<!-- 블로그 하단 -->
		<ins class="adsbygoogle"
			 style="display:block; margin-bottom:20px;"
			 data-ad-client="ca-pub-8163803188491150"
			 data-ad-slot="7841851420"
			 data-ad-format="auto"></ins>
		<script>
			(adsbygoogle = window.adsbygoogle || []).push({});
		</script>
		<!-- adsense -->

		<div class="pad-min"></div>
		<div id="post-comment" class="sheet post">
			<div id="disqus_thread"></div>
		</div>
	</div>
	<div class="content-navigation col-lg-3">
		<!-- I made it -->
		<section class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">I made it</h3>
			</div>
			<ul class="list-group">
				<li class="list-group-item"><a href="http://sprite.asamaru.net/" target="_blank">Sprite CSS/Image</a></li>
				<li class="list-group-item"><a href="http://loan.asamaru.net/" target="_blank">대출이자계산기</a></li>
				<li class="list-group-item"><a href="http://bookmarklet.asamaru.net/" target="_blank">북마클릿 생성기</a></li>
			</ul>
		</section>

		<!-- Categories -->
		
		
		<section class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Categories</h3>
			</div>
			<ul class="list-group">
				
				<li class="list-group-item"><a href="/category/thinking/">Thinking <span class="badge">3</span></a></li>
				
				<li class="list-group-item"><a href="/category/osx/">Osx <span class="badge">7</span></a></li>
				
				<li class="list-group-item"><a href="/category/programming/">Programming <span class="badge">1</span></a></li>
				
				<li class="list-group-item"><a href="/category/css/">Css <span class="badge">3</span></a></li>
				
				<li class="list-group-item"><a href="/category/js/">Js <span class="badge">10</span></a></li>
				
				<li class="list-group-item"><a href="/category/android/">Android <span class="badge">53</span></a></li>
				
				<li class="list-group-item"><a href="/category/octopress/">Octopress <span class="badge">8</span></a></li>
				
				<li class="list-group-item"><a href="/category/ios/">Ios <span class="badge">18</span></a></li>
				
				<li class="list-group-item"><a href="/category/php/">Php <span class="badge">23</span></a></li>
				
				<li class="list-group-item"><a href="/category/java/">Java <span class="badge">5</span></a></li>
				
				<li class="list-group-item"><a href="/category/db/">Db <span class="badge">6</span></a></li>
				
				<li class="list-group-item"><a href="/category/html/">Html <span class="badge">2</span></a></li>
				
				<li class="list-group-item"><a href="/category/git/">Git <span class="badge">7</span></a></li>
				
				<li class="list-group-item"><a href="/category/blog/">Blog <span class="badge">1</span></a></li>
				
				<li class="list-group-item"><a href="/category/tip/">Tip <span class="badge">13</span></a></li>
				
				<li class="list-group-item"><a href="/category/linux/">Linux <span class="badge">26</span></a></li>
				
				<li class="list-group-item"><a href="/category/swift/">Swift <span class="badge">6</span></a></li>
				
				<li class="list-group-item"><a href="/category/iOS/">Ios <span class="badge">2</span></a></li>
				
				<li class="list-group-item"><a href="/category/vagrant/">Vagrant <span class="badge">5</span></a></li>
				
				<li class="list-group-item"><a href="/category/jekyll/">Jekyll <span class="badge">2</span></a></li>
				
				<li class="list-group-item"><a href="/category/flash/">Flash <span class="badge">1</span></a></li>
				
			</ul>
		</section>
		
		

		<!-- Tags -->
		
		
		

		<!-- adsense -->
		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<!-- 블로그 우측 -->
		<ins class="adsbygoogle"
			 style="display:block; margin-bottom:20px;"
			 data-ad-client="ca-pub-8163803188491150"
			 data-ad-slot="1934918622"
			 data-ad-format="auto"></ins>
		<script>
			(adsbygoogle = window.adsbygoogle || []).push({});
		</script>
		<!-- adsense -->

		<!-- Related -->
		

		

		
		<section class="panel panel-default dRelatedPosts">
			<div class="panel-heading">
				<h3 class="panel-title">Related</h3>
			</div>
			<ul class="list-group">
				
				<li class="list-group-item"><a href="https://blog.asamaru.net/2016/09/27/android-adb-device-reconnect/">안드로이드 스튜디오에서 디바이스 연결이 끊어질 경우 다시 연결하는 방법</a></li>
				
				<li class="list-group-item"><a href="https://blog.asamaru.net/2016/09/23/google-service-library-9-6-0-used-read-phone-state-permission/">Google Service Library 9.6.0 사용시 READ_PHONE_STATE 권한이 추가되는 문제</a></li>
				
				<li class="list-group-item"><a href="https://blog.asamaru.net/2016/08/12/playing-html5-video-on-fullscreen-in-android-webview/">안드로이드 WebView에서 HTML5 Video Full Screen 지원</a></li>
				
				<li class="list-group-item"><a href="https://blog.asamaru.net/2016/08/01/android-webview-resumetimers-pausetimers/">안드로이드 WebView resumeTimers() / pauseTimers() 적용하기</a></li>
				
				<li class="list-group-item"><a href="https://blog.asamaru.net/2016/07/14/html-fromhtml-deprecated-in-android-n/">Html.fromHtml deprecated(Android N)</a></li>
				
			</ul>
		</section>
		

		<section class="panel panel-default">
			<style>
				#google_translate_country { text-align:center; padding-top:5px; }
				#google_translate_element > div { text-align:center; padding:5px 0; }
				#google_translate_element > div > div { display:inline-block; *display:inline; *zoom:1; margin-right:10px; }
			</style>
			<div id="google_translate_country">
				<a href="#googtrans(ko|en)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/English.gif?w=660" alt="English"/></a>
				<!-- <a href="#googtrans(ko|ko)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/Korean.gif?w=660" alt="Korean"/></a> -->
				<a href="#googtrans(ko|zh-CN)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/Chinese.gif?w=660" alt="Chinese"/></a>
				<a href="#googtrans(ko|ja)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/Japanese.gif?w=660" alt="Japanese"/></a>
				<a href="#googtrans(ko|fr)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/French.gif?w=660" alt="French"/></a>
				<a href="#googtrans(ko|de)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/German.gif?w=660" alt="German"/></a>
				<a href="#googtrans(ko|it)" onclick="setTimeout(function() { document.location.reload(); });"><img src="/static/img/lang/Italian.gif?w=660" alt="Italian"/></a>
			</div>
			<div id="google_translate_element"></div>
			<script type="text/javascript">
				function googleTranslateElementInit() {
					new google.translate.TranslateElement({pageLanguage: 'ko'}, 'google_translate_element');
				}
			</script>
			<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
		</section>
	</div>
</div>


		
		<div id="disqus_thread"></div>
		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
			var disqus_shortname = 'asamaru7'; // required: replace example with your forum shortname
			// var disqus_developer = 1; // Comment out when the site is live
			var disqus_identifier = "/2016/07/30/android-4-4-3-4-4-4-webview-referer-doesn-t-work/";

			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function () {
				var dsq = document.createElement('script');
				dsq.type = 'text/javascript';
				dsq.async = true;
				dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>
		<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
		
	</div>

	<div class="page-scrollTop" data-toggle="tooltip" data-placement="top" title="Top">
		<a href="javascript:void(0);">
			<div class="arrow"></div>
			<div class="stick"></div>
		</a>
	</div>
</div>

<footer class="footnote footnote-tiffany">
	<div class="container">
		<a class="foot-item" href="mailto:asamaru@asamaru.net" target="_blank"><img src="/static/img/bottom-email.png" alt="Email"></a>
		<a class="foot-item" href="https://github.com/asamaru7" target="_blank"><img src="/static/img/bottom-github.png" alt="Github"></a>
		<a class="foot-item" href="https://blog.asamaru.net/atom.xml" target="_blank"><img src="/static/img/bottom-rss.png" alt="RSS"></a>
		&nbsp;
		<a href="https://blog.asamaru.net"><span class="word-keep">&copy; 유영재</span></a>
	</div>
</footer>


<div class="scriptHub">
	<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
	<script type="text/javascript" src="https://blog.asamaru.net/static/js/script.js"></script>

	
	<script type="text/javascript" src="https://blog.asamaru.net/static/js/post.js"></script>
	
	
</div>



</body>
</html>
