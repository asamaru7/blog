<!DOCTYPE html>
<html>

<head>
	<title>이 세상에 하나는 남기고 가자</title>
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<meta name="author" content="유영재">
	<meta name="keywords" content="이 세상에 하나는 남기고 가자"/>
	<meta name="description" content="세상에 필요한 소스코드 한줄 남기고 가자.
"/>

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- http://opengraphprotocol.org/ -->
	<meta name="twitter:card" content="summary_large_image">
	<meta property="og:type" content="website">
	<meta property="og:url" content="http://blog.asamaru.net/posts/126/">
	<meta property="og:title" content="이 세상에 하나는 남기고 가자">
	<meta property="og:description" content="세상에 필요한 소스코드 한줄 남기고 가자.
">

	<link rel="canonical" href="http://blog.asamaru.net/posts/126/"/>
	<link rel="shortcut icon" type="image/x-icon" media="screen" href="http://blog.asamaru.net/favicon.ico"/>
	<link rel="alternate" type="application/rss+xml" title="이 세상에 하나는 남기고 가자" href="http://blog.asamaru.net/atom.xml"/>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="http://blog.asamaru.net/static/css/style.css"/>
	<link rel="stylesheet" type="text/css" href="http://blog.asamaru.net/static/css/highlight.css"/>

	
	
	<link rel="stylesheet" type="text/css" href="http://blog.asamaru.net/static/css/article-list.css"/>
	

	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
					(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-65749108-2', 'auto');
		ga('send', 'pageview');

	</script>
</head>


<body>
<div class="main">

	<nav class="navbar navbar-default" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" title="toggle navbar" data-toggle="collapse" data-target=".navbar-collapse">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">이 세상에 하나는 남기고 가자</a>
		</div>

		<div class="navbar-collapse collapse">
			
			<ul class="nav navbar-nav">
				<li class="active">
				<a rel="index" href="/">Blog</a>
				</li>
				<li >
				<a href="/archives/">Archives</a>
				</li>
			</ul>
			<ul class="nav navbar-nav navbar-right">
				<li>
					<a class="subscribe-rss" href="http://blog.asamaru.net/atom.xml" title="subscribe via RSS">
						<span class="visible-xs">RSS</span>
						<img class="hidden-xs" src="/static/img/rss.png" alt="RSS">
					</a>
				</li>
			</ul>
			
			<form class="navbar-form navbar-right" action="https://www.google.com/search" method="GET">
				<input type="hidden" name="sitesearch" value="http://blog.asamaru.net">
				<div class="form-group">
					<input class="form-control" type="text" name="q" placeholder="Search">
				</div>
			</form>
			
		</div>
	</div>
</nav>


	<div class="container">
		<div class="row index">
	<div class="content col-lg-9">
		<div>
			<section class="category-slice" post-cate="All">
				
				<article>
					<div class="module">
						<header>
							<a class="title" href="http://blog.asamaru.net/2015/08/28/android-getcolor-getdrawable-deprecated/">
								Android 6(API 23)의 getColor() deprecated 대응 + getDrawable() deprecated
							</a>
							<p class="post-meta">
								<a href="http://blog.asamaru.net/2015/08/28/android-getcolor-getdrawable-deprecated/">2015.08.28.</span></a>
							</p>
						</header>
						<p>
							<p>얼마전 Android API 23 버전이 공개되었다. 이와함께 support library, design support library도 함께 23 버전으로 버전업 되었다.</p>

<p>이에따라 여러가지 UI들이 추가되어 필요한 부분을 적용해 보고자 gradle을 수정하고 build 하니 getColor 함수가 deprecated 되었다는 warning을 보게되었다.</p>

<p>아… 최근에 안드로이드는 기본 함수들을 너무 많이 바꾼다. 사실 이번 버전업으로 이것뿐아니라 http 관련된  api가 제거 되었다. 이미 이전부터 deprecated 되었었긴하지만 너무 갑작스럽기도 하다.
현재시점에서 ACRA, android-async-http 등의 오픈소스들도 대응이 되지 않았다. 이에 따른 대응방법도 구글에 안내되어 있긴하다.</p>

<p><a href="https://developer.android.com/intl/ko/preview/behavior-changes.html#behavior-apache-http-client">Apache HTTP 클라이언트 제거</a></p>

<p>하지만 임시방편일 뿐 계속 사용하기엔 석연치 않다. 조금더 자세한 내용은 다음에 다시 글을 쓰도록 하겠다.
(추가 포스팅 : <a href="/2015/09/25/android-6-apache-http-client-removal/">Android 6(API 23 : marshmallow) : Apache HTTP 클라이언트 제거</a>)</p>

<p>다시 본론으로 돌아와서 이 부분을 해결하기 위해서는 ContextCompat(android.support.v4.content.ContextCompat)을 사용하면 된다.
단, support library 23 이상이 필요할 수 있다. 이하에서는 확인을 못했다.</p>

<p>함수는 아래와 같이 구성되어 있다.</p>

<figure class='code'><div class="highlight notranslate"><pre><code class="language-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">getColor</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">version</span> <span class="o">=</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mi">23</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ContextCompatApi23</span><span class="o">.</span><span class="na">getColor</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">getResources</span><span class="o">().</span><span class="na">getColor</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></code></pre></div></figure>

<p>실제사용은</p>

<figure class='code'><div class="highlight notranslate"><pre><code class="language-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">ContextCompat</span><span class="o">.</span><span class="na">getColor</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">resourceId</span><span class="o">);</span>
</pre></div>
</td></tr></table></code></pre></div></figure>
<p>이렇게 하면된다. 어떻게보면 기존보다 더 편하다. 하지만 기존에 getColor를 사용하던 부분을 고치는 것은 우리가 해야한다.</p>

<p>추가로 보다 더 이전에 deprecated된 함수 getDrawable()가 있다. 이건 정확하지 않지만 API 21부터 deprecated 된 것 같다.
이 문제도 동일한 class를 통해 해결 가능하다.</p>

<figure class='code'><div class="highlight notranslate"><pre><code class="language-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Drawable</span> <span class="nf">getDrawable</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">version</span> <span class="o">=</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">version</span> <span class="o">&gt;=</span> <span class="mi">21</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ContextCompatApi21</span><span class="o">.</span><span class="na">getDrawable</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">getResources</span><span class="o">().</span><span class="na">getDrawable</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></code></pre></div></figure>

<p>요즘 분위기를 보면 이런식으로 deprecated 되는 함수가 많다. 사실 개인적으로 많은 것은 기존 안드로이드가 워낙 엉망이라고 보기 때문에 문제가 되지 않는다고 생각하지만 처리하는 과정은 맘에 들이 않는다.
한번에 싹 정리하지 않고 눈에 띄면 추가하듯 띄엄띄엄 deprecated 함수를 늘리고 실제 제거까지 오래 기다리지 않는다. 이건 꼭 새로운 버전을 사용하지 말라고 권장하는 것도 아니고 쓰라는 것도 아니고…</p>

<p>마지막으로 PhoneNumberUtils.formatNumber 함수 예기만 하나더 하자면</p>

<figure class='code'><div class="highlight notranslate"><pre><code class="language-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">formatNumber</span><span class="o">(</span><span class="n">String</span> <span class="n">source</span><span class="o">);</span>
</pre></div>
</td></tr></table></code></pre></div></figure>

<p>이 함수도 deprecated 되었다. 이제는 두번째 인자로 포멧팅할 국가 코드를 넣어야 한다.</p>

<figure class='code'><div class="highlight notranslate"><pre><code class="language-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">PhoneNumberUtils</span><span class="o">.</span><span class="na">formatNumber</span><span class="o">(</span><span class="n">number</span><span class="o">,</span> <span class="s">&quot;KR&quot;</span><span class="o">);</span>
</pre></div>
</td></tr></table></code></pre></div></figure>

<p>그게 대응이 어려운 문제는 아니다. 하지만 위의 문제들과 더불어 굳이 deprecated 했어야 하는가? 하는 부분이다.
개인적인 생각으로 두번째 인자를 생략하면 기존처럼 국가코드를 자동으로 넣으면 되지 않는가? 일부 다국어 지원 앱에서 조금더 명확한 사용을 하기 위해 대다수의 단일국가 지원 앱들이 불편을 감수해야하는가?
다음이 기존함수이다.</p>

<figure class='code'><div class="highlight notranslate"><pre><code class="language-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@Deprecated</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">formatNumber</span><span class="o">(</span><span class="n">String</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">SpannableStringBuilder</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">SpannableStringBuilder</span><span class="o">(</span><span class="n">source</span><span class="o">);</span>
    <span class="n">formatNumber</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="n">getFormatTypeForLocale</span><span class="o">(</span><span class="n">Locale</span><span class="o">.</span><span class="na">getDefault</span><span class="o">()));</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></code></pre></div></figure>

<p>보다시피 <code>Locale.getDefault()</code> 부분을 넣어주고 있었다. 어쨌든 나는 아래와 같은 호환 함수를 만들어서 사용하고 있다.</p>

<figure class='code'><div class="highlight notranslate"><pre><code class="language-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">static</span> <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFormattedPhoneNumber</span><span class="o">(</span><span class="n">String</span> <span class="n">number</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">LOLLIPOP</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">PhoneNumberUtils</span><span class="o">.</span><span class="na">formatNumber</span><span class="o">(</span><span class="n">number</span><span class="o">,</span> <span class="s">&quot;KR&quot;</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="c1">// noinspection deprecation</span>
        <span class="k">return</span> <span class="n">PhoneNumberUtils</span><span class="o">.</span><span class="na">formatNumber</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></code></pre></div></figure>

						<!--
							{ % if post.excerpt.size > 32 % }
							{ { post.excerpt } }
							{ % else % }
							{ { post.content | strip_html | strip_newlines | truncate: 160 } }
							{ % endif % }
						-->
						</p>
						
						<footer>
							
                      <span class="word-keep pull-right">
                          <a href="http://blog.asamaru.net/2015/08/28/android-getcolor-getdrawable-deprecated/#post-comment"><span class="glyphicon glyphicon-comment"></span>&nbsp;Comment</a>
                          <a href="http://blog.asamaru.net/2015/08/28/android-getcolor-getdrawable-deprecated/#post-share"><span class="glyphicon glyphicon-heart"></span>&nbsp;Share</a>
                      </span>
						</footer>
					</div>
				</article>
				
			</section>

			<nav class="text-center">
				<ul class="pager">
					
					<li class="previous"><a href="/posts/127">&larr;&nbsp;이전글</a></li>
					
					<li><a href="/archives/">Blog Archives</a></li>
					
					<li class="next"><a href="/posts/125">다음글&nbsp;&rarr;</a></li>
					
				</ul>
			</nav>
		</div>
		<div class="adsense-bottom">
			<!-- adsense -->
			<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<!-- 블로그 하단 -->
			<ins class="adsbygoogle"
				 style="display:block"
				 data-ad-client="ca-pub-8163803188491150"
				 data-ad-slot="7841851420"
				 data-ad-format="auto"></ins>
			<script>
				(adsbygoogle = window.adsbygoogle || []).push({});
			</script>
			<!-- adsense -->
		</div>
	</div>
	<div class="content-navigation col-lg-3">
		<!-- adsense -->
		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<!-- 블로그 우측 -->
		<ins class="adsbygoogle"
			 style="display:block"
			 data-ad-client="ca-pub-8163803188491150"
			 data-ad-slot="1934918622"
			 data-ad-format="auto"></ins>
		<script>
			(adsbygoogle = window.adsbygoogle || []).push({});
		</script>
		<!-- adsense -->
	</div>
</div>


		
	</div>

	<div class="page-scrollTop" data-toggle="tooltip" data-placement="top" title="Top">
		<a href="javascript:void(0);">
			<div class="arrow"></div>
			<div class="stick"></div>
		</a>
	</div>
</div>

<footer class="footnote footnote-tiffany">
	<div class="container">
		<a class="foot-item" href="mailto:asamaru@asamaru.net" target="_blank"><img src="/static/img/bottom-email.png" alt="Email"></a>
		<a class="foot-item" href="https://github.com/asamaru7" target="_blank"><img src="/static/img/bottom-github.png" alt="Github"></a>
		<a class="foot-item" href="http://blog.asamaru.net/atom.xml" target="_blank"><img src="/static/img/bottom-rss.png" alt="RSS"></a>
		&nbsp;
		<a href="http://blog.asamaru.net"><span class="word-keep">&copy; 유영재</span></a>
	</div>
</footer>


<div class="scriptHub">
	<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
	<script type="text/javascript" src="http://blog.asamaru.net/static/js/script.js"></script>

	
	
</div>



</body>
</html>
