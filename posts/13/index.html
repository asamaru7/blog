<!DOCTYPE html>
<html>

<head>
	<title>이 세상에 하나는 남기고 가자</title>
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<meta name="author" content="유영재">
	<meta name="keywords" content="이 세상에 하나는 남기고 가자"/>
	<meta name="description" content="세상에 필요한 소스코드 한줄 남기고 가자.
"/>

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- http://opengraphprotocol.org/ -->
	<meta name="twitter:card" content="summary_large_image">
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://blog.asamaru.net/posts/13/">
	<meta property="og:title" content="이 세상에 하나는 남기고 가자">
	<meta property="og:description" content="세상에 필요한 소스코드 한줄 남기고 가자.
">

	<link rel="canonical" href="https://blog.asamaru.net/posts/13/"/>
	<link rel="shortcut icon" type="image/x-icon" media="screen" href="https://blog.asamaru.net/favicon.ico"/>
	<link rel="alternate" type="application/rss+xml" title="이 세상에 하나는 남기고 가자" href="https://blog.asamaru.net/atom.xml"/>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="https://blog.asamaru.net/static/css/style.css"/>
	<link rel="stylesheet" type="text/css" href="https://blog.asamaru.net/static/css/highlight.css"/>

	
	
	<link rel="stylesheet" type="text/css" href="https://blog.asamaru.net/static/css/article-list.css"/>
	

	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
					(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-65749108-2', 'auto');
		ga('send', 'pageview');

	</script>
</head>


<body>
<div class="main">

	<nav class="navbar navbar-default" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" title="toggle navbar" data-toggle="collapse" data-target=".navbar-collapse">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">이 세상에 하나는 남기고 가자</a>
		</div>

		<div class="navbar-collapse collapse">
			
			<ul class="nav navbar-nav">
				<li class="active">
				<a rel="index" href="/">Blog</a>
				</li>
				<li >
				<a href="/archives/">Archives</a>
				</li>
			</ul>
			<ul class="nav navbar-nav navbar-right">
				<li>
					<a class="subscribe-rss" href="https://blog.asamaru.net/atom.xml" title="subscribe via RSS">
						<span class="visible-xs">RSS</span>
						<img class="hidden-xs" src="/static/img/rss.png" alt="RSS">
					</a>
				</li>
			</ul>
			
			<!-- <form class="navbar-form navbar-right" action="http://www.google.co.kr" id="cse-search-box" target="_blank">
			  <div class="form-group">
			    <input type="hidden" name="cx" value="partner-pub-8163803188491150:6044663021" />
			    <input type="hidden" name="ie" value="UTF-8" />
			    <input type="text" name="q" class="form-control" />
			    <input type="submit" name="sa" value="&#xac80;&#xc0c9;" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.co.kr/coop/cse/brand?form=cse-search-box&amp;lang=ko"></script> -->
			<form class="navbar-form navbar-right" action="https://www.google.com/search" method="GET">
				<input type="hidden" name="sitesearch" value="https://blog.asamaru.net">
				<div class="form-group">
					<input class="form-control" type="text" name="q" placeholder="Search">
				</div>
			</form>
			
		</div>
	</div>
</nav>


	<div class="container">
		<div class="row index">
	<div class="content col-lg-9">
		<div>
			<section class="category-slice" post-cate="All">
				
				<article>
					<div class="module">
						<header>
							<a class="title" href="https://blog.asamaru.net/2016/07/12/android-textview-with-a-single-line-in-viewpager-scroll-doesnt-work/">
								안드로이드 : TextView 터치시 가로 스크롤이 되지 않는 문제 수정(ViewPager 등에서)
							</a>
							<p class="post-meta">
								<a href="https://blog.asamaru.net/2016/07/12/android-textview-with-a-single-line-in-viewpager-scroll-doesnt-work/">2016.07.12.</span></a>
							</p>
						</header>
						<p>
							<p>오늘도 역시 안드로이드는 실망시키지 않는다. 오늘의 문제는 이렇다.</p>

<blockquote>
  <p>가로 스크롤되는 ViewPager의 Item View에 TextView가 포함되도록 구성되어 있을 경우 TextView 위에서 터치를 하면 가로 스크롤이 동작하지 않는 문제가 발생한다. 조금 더 정확히 이야기하자면 <code class="highlighter-rouge">singleLine</code> 속성이 true로 설정된 TextView들이 가로 스크롤을 정상 동작하지 않도록 만든다.</p>
</blockquote>

<p>처음엔 click 이벤트로 인한 문제로 생각했다. 실제로 아래에 깔린 View의 click 이벤트를 제거하니 스크롤이 정상적으로 동작했다. 그런데 다른 UI에서 동일한 형태로 사용중이나 그곳에서는 해당 문제가 발생하지 않기에 다른 원인이 있을 것이라는 판단으로 조금 더 찾아봤다.</p>

<p>결국 원인을 찾고보니 <code class="highlighter-rouge">android:scrollHorizontally</code> 속성이 true로 설정될 경우 해당 문제가 발생했다. TextView의 scroll 처리 영역과 ViewPager의 scroll 처리가 충돌하는 것이다. 그런데 나는 이 속성을 true로 주지 않았기 때문에 이상하다고 생각하고 <code class="highlighter-rouge">TextView.java</code> 파일의 내부를 보다가 아래의 코드를 찾았다.</p>

<p><strong>TextView.java</strong></p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">applySingleLine</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">singleLine</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">applyTransformation</span><span class="o">,</span>
        <span class="kt">boolean</span> <span class="n">changeMaxLines</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">mSingleLine</span> <span class="o">=</span> <span class="n">singleLine</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">singleLine</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">setLines</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">setHorizontallyScrolling</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">applyTransformation</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">setTransformationMethod</span><span class="o">(</span><span class="n">SingleLineTransformationMethod</span><span class="o">.</span><span class="na">getInstance</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">changeMaxLines</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">setMaxLines</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">setHorizontallyScrolling</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">applyTransformation</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">setTransformationMethod</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>그렇다. <code class="highlighter-rouge">singleLine</code> 속성을 사용하면 자동적으로 <code class="highlighter-rouge">setHorizontallyScrolling(true);</code>가 적용되는 것이다. 여담이지만 <code class="highlighter-rouge">android:scrollHorizontally</code> 설정 상태를 확인하기 위해 <code class="highlighter-rouge">TextView.java</code>에 있는 아래의 함수를 호출해 봤더니 해당 함수를 못찾는다. 최신 SDK에 들어간 것도 아니고 public 인데도 불구하고… 역시 이상한 안드로이드.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">getHorizontallyScrolling</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">mHorizontallyScrolling</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>

<p>어쨌든 이를 해결하기 위해 아래와 같이 style을 정의해서 TextView에 적용해 봤다.</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;style</span> <span class="na">name=</span><span class="s">"TextViewBaseStyle"</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- 가로 스크롤 문제를 발생시키는 속성 --&gt;</span>
  <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"android:singleLine"</span><span class="nt">&gt;</span>true<span class="nt">&lt;/item&gt;</span>
  <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"android:ellipsize"</span><span class="nt">&gt;</span>end<span class="nt">&lt;/item&gt;</span>
  <span class="c">&lt;!-- 가로 스크롤 문제를 개선하기 위한 시도 --&gt;</span>
  <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"android:scrollHorizontally"</span><span class="nt">&gt;</span>false<span class="nt">&lt;/item&gt;</span>
  <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"android:clickable"</span><span class="nt">&gt;</span>false<span class="nt">&lt;/item&gt;</span>
  <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"android:focusable"</span><span class="nt">&gt;</span>false<span class="nt">&lt;/item&gt;</span>
  <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"android:focusableInTouchMode"</span><span class="nt">&gt;</span>false<span class="nt">&lt;/item&gt;</span>
<span class="nt">&lt;/style&gt;</span>
</code></pre>
</div>

<p>결론은 안된다. <code class="highlighter-rouge">android:scrollHorizontally</code> 값이 위에 보여준 코드에 의해 무시되는 결과를 가져오는 것이다.</p>

<p>따라서 해결 방법은 아래의 방법 밖에 없다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">textView</span><span class="o">.</span><span class="na">setHorizontallyScrolling</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</code></pre>
</div>

<p>그렇다. 프로그램에서 직접 <code class="highlighter-rouge">android:scrollHorizontally</code>를 false로 설정하는 것 외에는 다른 방법이 없다. <code class="highlighter-rouge">TextView.java</code> 내부에서 직접 true를 지정하고 있으므로 해당 코드를 오버라이딩 할 것이 아니라면 이 방법 밖에는 없다. 생성자 내부에서 처리 순서가 아래와 같기 때문에 <code class="highlighter-rouge">singleLine</code> 속성을 사용한다면 다른 방법이 없는 것이다. 도대체 TextView 개발자는 무슨 생각으로 코드를 짠 것인가?</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="o">...</span>
<span class="k">case</span> <span class="n">com</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">R</span><span class="o">.</span><span class="na">styleable</span><span class="o">.</span><span class="na">TextView_scrollHorizontally</span><span class="o">:</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">getBoolean</span><span class="o">(</span><span class="n">attr</span><span class="o">,</span> <span class="kc">false</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">setHorizontallyScrolling</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">break</span><span class="o">;</span>
<span class="o">...</span>
<span class="n">applySingleLine</span><span class="o">(</span><span class="n">singleLine</span><span class="o">,</span> <span class="n">singleLine</span><span class="o">,</span> <span class="n">singleLine</span><span class="o">);</span>
<span class="o">...</span>          
</code></pre>
</div>

<hr />

<p><strong>추가</strong></p>

<p>조금 더 알아보니 <code class="highlighter-rouge">singleLine</code> 속성 자체가 API 3에서 deprecated 되었다가 다시 풀린 것으로 보인다. 대신 <code class="highlighter-rouge">maxLines</code> 속성을 권장하는 것으로 보인다. 하지만 <code class="highlighter-rouge">singleLine</code> 자체도 <code class="highlighter-rouge">marquee</code> 등의 기능 사용을 위해 필요한 곳이 있다. <a href="http://stackoverflow.com/a/31871217">android singleLine vs maxLines</a></p>

<p>결론은 위의 방법을 사용하거나 <code class="highlighter-rouge">singleLine</code> 속성 대신 <code class="highlighter-rouge">maxLines</code> 속성에 1을 주는 방법으로 <code class="highlighter-rouge">ellipsize</code>를 처리하는 방법이 있다. 사실 이 부분의 경우 하위 버전의 안드로이드에서 정상 동작하지 않는 문제가 있었던 것으로 보이나 현재 시점에서 테스트 해봤을 때는 정상 동작했다. <code class="highlighter-rouge">singleLine</code> 속성은 내부적으로 추가적인 처리를 하는 것으로 보이니 성능면에서도 <code class="highlighter-rouge">maxLines</code>를 사용하는 것을 권장한다.</p>

						<!--
							{ % if post.excerpt.size > 32 % }
							{ { post.excerpt } }
							{ % else % }
							{ { post.content | strip_html | strip_newlines | truncate: 160 } }
							{ % endif % }
						-->
						</p>
						
						<footer>
							
                      <span class="word-keep pull-right">
                          <a href="https://blog.asamaru.net/2016/07/12/android-textview-with-a-single-line-in-viewpager-scroll-doesnt-work/#post-comment"><span class="glyphicon glyphicon-comment"></span>&nbsp;Comment</a>
                          <a href="https://blog.asamaru.net/2016/07/12/android-textview-with-a-single-line-in-viewpager-scroll-doesnt-work/#post-share"><span class="glyphicon glyphicon-heart"></span>&nbsp;Share</a>
                      </span>
						</footer>
					</div>
				</article>
				
			</section>

			<nav class="text-center">
				<ul class="pager">
					
					<li class="previous"><a href="/posts/14">&larr;&nbsp;이전글</a></li>
					
					<li><a href="/archives/">Blog Archives</a></li>
					
					<li class="next"><a href="/posts/12">다음글&nbsp;&rarr;</a></li>
					
				</ul>
			</nav>
		</div>
		<div class="adsense-bottom">
			<!-- adsense -->
			<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<!-- 블로그 하단 -->
			<ins class="adsbygoogle"
				 style="display:block"
				 data-ad-client="ca-pub-8163803188491150"
				 data-ad-slot="7841851420"
				 data-ad-format="auto"></ins>
			<script>
				(adsbygoogle = window.adsbygoogle || []).push({});
			</script>
			<!-- adsense -->
		</div>
	</div>
	<div class="content-navigation col-lg-3">
		<!-- adsense -->
		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<!-- 블로그 우측 -->
		<ins class="adsbygoogle"
			 style="display:block"
			 data-ad-client="ca-pub-8163803188491150"
			 data-ad-slot="1934918622"
			 data-ad-format="auto"></ins>
		<script>
			(adsbygoogle = window.adsbygoogle || []).push({});
		</script>
		<!-- adsense -->
	</div>
</div>


		
	</div>

	<div class="page-scrollTop" data-toggle="tooltip" data-placement="top" title="Top">
		<a href="javascript:void(0);">
			<div class="arrow"></div>
			<div class="stick"></div>
		</a>
	</div>
</div>

<footer class="footnote footnote-tiffany">
	<div class="container">
		<a class="foot-item" href="mailto:asamaru@asamaru.net" target="_blank"><img src="/static/img/bottom-email.png" alt="Email"></a>
		<a class="foot-item" href="https://github.com/asamaru7" target="_blank"><img src="/static/img/bottom-github.png" alt="Github"></a>
		<a class="foot-item" href="https://blog.asamaru.net/atom.xml" target="_blank"><img src="/static/img/bottom-rss.png" alt="RSS"></a>
		&nbsp;
		<a href="https://blog.asamaru.net"><span class="word-keep">&copy; 유영재</span></a>
	</div>
</footer>


<div class="scriptHub">
	<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
	<script type="text/javascript" src="https://blog.asamaru.net/static/js/script.js"></script>

	
	
</div>



</body>
</html>
