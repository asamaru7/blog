<!DOCTYPE html>
<html>

<head>
	<title>이 세상에 하나는 남기고 가자</title>
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<meta name="author" content="유영재">
	<meta name="keywords" content="이 세상에 하나는 남기고 가자"/>
	<meta name="description" content="세상에 필요한 소스코드 한줄 남기고 가자.
"/>

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- http://opengraphprotocol.org/ -->
	<meta name="twitter:card" content="summary_large_image">
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://blog.asamaru.net/posts/29/">
	<meta property="og:title" content="이 세상에 하나는 남기고 가자">
	<meta property="og:description" content="세상에 필요한 소스코드 한줄 남기고 가자.
">

	<link rel="canonical" href="https://blog.asamaru.net/posts/29/"/>
	<link rel="shortcut icon" type="image/x-icon" media="screen" href="https://blog.asamaru.net/favicon.ico"/>
	<link rel="alternate" type="application/rss+xml" title="이 세상에 하나는 남기고 가자" href="https://blog.asamaru.net/atom.xml"/>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="https://blog.asamaru.net/static/css/style.css"/>
	<link rel="stylesheet" type="text/css" href="https://blog.asamaru.net/static/css/highlight.css"/>

	
	
	<link rel="stylesheet" type="text/css" href="https://blog.asamaru.net/static/css/article-list.css"/>
	

	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
					(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-65749108-2', 'auto');
		ga('send', 'pageview');

	</script>
</head>


<body>
<div class="main">

	<nav class="navbar navbar-default" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" title="toggle navbar" data-toggle="collapse" data-target=".navbar-collapse">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">이 세상에 하나는 남기고 가자</a>
		</div>

		<div class="navbar-collapse collapse">
			
			<ul class="nav navbar-nav">
				<li class="active">
				<a rel="index" href="/">Blog</a>
				</li>
				<li >
				<a href="/archives/">Archives</a>
				</li>
			</ul>
			<ul class="nav navbar-nav navbar-right">
				<li>
					<a class="subscribe-rss" href="https://blog.asamaru.net/atom.xml" title="subscribe via RSS">
						<span class="visible-xs">RSS</span>
						<img class="hidden-xs" src="/static/img/rss.png" alt="RSS">
					</a>
				</li>
			</ul>
			
			<!-- <form class="navbar-form navbar-right" action="http://www.google.co.kr" id="cse-search-box" target="_blank">
			  <div class="form-group">
			    <input type="hidden" name="cx" value="partner-pub-8163803188491150:6044663021" />
			    <input type="hidden" name="ie" value="UTF-8" />
			    <input type="text" name="q" class="form-control" />
			    <input type="submit" name="sa" value="&#xac80;&#xc0c9;" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.co.kr/coop/cse/brand?form=cse-search-box&amp;lang=ko"></script> -->
			<form class="navbar-form navbar-right" action="https://www.google.com/search" method="GET">
				<input type="hidden" name="sitesearch" value="https://blog.asamaru.net">
				<div class="form-group">
					<input class="form-control" type="text" name="q" placeholder="Search">
				</div>
			</form>
			
		</div>
	</div>
</nav>


	<div class="container">
		<div class="row index">
	<div class="content col-lg-9">
		<div>
			<section class="category-slice" post-cate="All">
				
				<article>
					<div class="module">
						<header>
							<a class="title" href="https://blog.asamaru.net/2016/03/07/git-socks5-proxy/">
								ssh proxy를 이용한 git 사용하기
							</a>
							<p class="post-meta">
								<a href="https://blog.asamaru.net/2016/03/07/git-socks5-proxy/">2016.03.07.</span></a>
							</p>
						</header>
						<p>
							<p>앞서 <a href="/2015/09/21/how-to-install-gogs-on-centos/">CentOS에 gogs 설치하기</a>,
<a href="/2015/09/22/how-to-install-gitlib-on-centos/">CentOS에 Gitlab 설치하기</a>, <a href="/2015/10/12/gitlab-ce-to-gitlab-dot-com/">자체 설치한 gitlab-ce에서 gitlab.com으로 이전하다</a>에서 언급했던 것처럼 git 저장소로 <a href="https://gitlab.com/">gitlab.com</a>을 사용중이다. 한동안은 아무 문제없이 잘 사용하고 있었다. 아니 사실 gitlab.com에 접속이 되지 않는 문제가 간헐적으로 발생했었다. 얼마전까지만 하더라도 해외 서비스에서 서비스되는 사이트라서 그런가보다 했다.</p>

<p>그런데 몇일 전부터 회사 네트워크에서 <a href="https://gitlab.com/">gitlab.com</a>에 접속할 수 없었다. 웹사이트뿐 아니라 git push/pull도 할 수가 없었다. 처음엔 회사 네트워크 방화벽 문제인 줄 알고 확인했으나 아니었다. 그래서 tracepath로 확인해 보니 SK Broadband 네트워크를 벗어나지 못하고 있었다(회사 네트워크가 SK다). 이상해서 조금 검색해보니 예전부터 SK Broadband의 해외 사이트 접속 문제가 유명했던 것 같다. 사람들의 이야기를 봐도 SK에 이야기한다고 해결될 문제는 아닌 것 같고… 그렇다고 git를 사용하지 않을 수 없어서 다른 방법을 찾아야 했다.</p>

<p>다행히 회사엔 외부망(SK가 아닌)에 연결된 Proxy가 하나 있다. 그래서 그 Proxy를 사용해서 급한대로 gitlab.com에 push/pull 하고 있다. 조금 더 기다려볼 생각이지만 빠른 시일 내에 접속이 복구되지 않는다면 다시 설치형 gitlab을 검토해야 할 것 같다.</p>

<hr />

<p>본론으로 들어가서 위의 이유로 인해 사용하게된 ssh proxy에 대한 처리 방법을 설명하려고 한다. 이번에 필요에 의해 적용한 환경은 CentOS 7과 OSX 10.11 이다.</p>

<p><strong>CentOS 7</strong></p>

<p><code>~/.ssh/config</code> 파일에 아래의 내용을 추가 한다.</p>

<figure class='code'><div class="highlight notranslate"><pre><code class="nmcode">Host gitlab.com
    User                    git
    ProxyCommand            socat STDIO SOCKS4:[proxy ip]:%h:%p,socksport=[proxy port]
</code></pre></div></figure>

<p>여기서 중요한 부분. <code>socat</code>이 설치되어 있어야 한다. 설치되어 있지 않다면 간단히 <code>yum install socat</code>을 통해 설치할 수 있다.</p>

<p>그리고 <code>SOCKS4</code>는 Proxy의 프로토콜에 따라 변경되어야 한다. 사실 내가 사용한 Proxy는 <code>SOCKS5</code>를 사용하는데 <code>SOCKS5</code>를 지정하면 오류가 나고 <code>SOCKS4</code>를 지정해야만 정상 동작했다. 기타 프로토콜의 경우는 <a href="http://www.dest-unreach.org/socat/">socat</a>를 참고.</p>

<p>위 처리를 하고나면 “gitlab.com” 도메인에 대해서는 ssh 접속시 지정한 Proxy를 사용한다. 따라서 git 명령을 사용하면 Proxy를 통해서 데이터가 전달된다. 단, ssh를 사용해서 git remote가 연결된 경우에.</p>

<p><strong>OSX</strong></p>

<p>OSX 또한 <code>~/.ssh/config</code> 파일에 아래의 내용을 추가 한다.</p>

<figure class='code'><div class="highlight notranslate"><pre><code class="nmcode">Host gitlab.com
    User                    git
    ProxyCommand            nc -X 5 -x [proxy ip]:[proxy port] %h %p
</code></pre></div></figure>

<p>OSX도 CentOS와 방법은 동일하나 socat 대신 nc(<a href="http://netcat.sourceforge.net/">netcat</a>)를 사용하고 있다. nc가 기본적으로 설치되어 있어서 그냥 nc를 사용했다. 어짜피 원리는 같다.
nc의 경우는 -X 뒤에 있는 5가 Proxy 프로토콜을 뜻한다.</p>

<blockquote>
  <p>-X proxy_version
            Requests that nc should use the specified protocol when talking to the proxy server.  Supported protocols are “4” (SOCKS v.4), “5”
            (SOCKS v.5) and “connect” (HTTPS proxy).  If the protocol is not specified, SOCKS version 5 is used.</p>
</blockquote>

<p><strong>PHPStorm</strong></p>

<p>덤으로 PHPStorm과 같은 IntelliJ IDE에서의 설정을 설명한다. 기본적으로 IntelliJ는 Git의 ssh 클라이언트를 Built-in을 사용한다. 이 설정을 Native로 바꿔주면 위에서 설정한 <code>~/.ssh/config</code> 파일의 설정을 그대로 적용시킬 수 있다. 메뉴의 위치는 “Preference &gt; Version Control &gt; Git”에서 “SSH executable”를 찾으면 된다.</p>

<hr />

<p>위 방법은 ssh의 설정을 이용한 방법이지만 git의 설정한 방법도 있다. 개인적으로 git에 설정하는게 더 복잡해서 그냥 ssh에 설정하는 것을 선택했을 뿐이다.</p>

<p><strong>참고글</strong></p>

<ul>
  <li><a href="http://cms-sw.github.io/tutorial-proxy.html">Tutorial: how to use git through a proxy</a></li>
  <li><a href="http://www.jones.ec/blogs/a/entry/using_git_through_a_socks/">Using git through a SOCKS proxy (or SSH tunnel)</a></li>
</ul>

						<!--
							{ % if post.excerpt.size > 32 % }
							{ { post.excerpt } }
							{ % else % }
							{ { post.content | strip_html | strip_newlines | truncate: 160 } }
							{ % endif % }
						-->
						</p>
						
						<footer>
							
                      <span class="word-keep pull-right">
                          <a href="https://blog.asamaru.net/2016/03/07/git-socks5-proxy/#post-comment"><span class="glyphicon glyphicon-comment"></span>&nbsp;Comment</a>
                          <a href="https://blog.asamaru.net/2016/03/07/git-socks5-proxy/#post-share"><span class="glyphicon glyphicon-heart"></span>&nbsp;Share</a>
                      </span>
						</footer>
					</div>
				</article>
				
			</section>

			<nav class="text-center">
				<ul class="pager">
					
					<li class="previous"><a href="/posts/30">&larr;&nbsp;이전글</a></li>
					
					<li><a href="/archives/">Blog Archives</a></li>
					
					<li class="next"><a href="/posts/28">다음글&nbsp;&rarr;</a></li>
					
				</ul>
			</nav>
		</div>
		<div class="adsense-bottom">
			<!-- adsense -->
			<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<!-- 블로그 하단 -->
			<ins class="adsbygoogle"
				 style="display:block"
				 data-ad-client="ca-pub-8163803188491150"
				 data-ad-slot="7841851420"
				 data-ad-format="auto"></ins>
			<script>
				(adsbygoogle = window.adsbygoogle || []).push({});
			</script>
			<!-- adsense -->
		</div>
	</div>
	<div class="content-navigation col-lg-3">
		<!-- adsense -->
		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<!-- 블로그 우측 -->
		<ins class="adsbygoogle"
			 style="display:block"
			 data-ad-client="ca-pub-8163803188491150"
			 data-ad-slot="1934918622"
			 data-ad-format="auto"></ins>
		<script>
			(adsbygoogle = window.adsbygoogle || []).push({});
		</script>
		<!-- adsense -->
	</div>
</div>


		
	</div>

	<div class="page-scrollTop" data-toggle="tooltip" data-placement="top" title="Top">
		<a href="javascript:void(0);">
			<div class="arrow"></div>
			<div class="stick"></div>
		</a>
	</div>
</div>

<footer class="footnote footnote-tiffany">
	<div class="container">
		<a class="foot-item" href="mailto:asamaru@asamaru.net" target="_blank"><img src="/static/img/bottom-email.png" alt="Email"></a>
		<a class="foot-item" href="https://github.com/asamaru7" target="_blank"><img src="/static/img/bottom-github.png" alt="Github"></a>
		<a class="foot-item" href="https://blog.asamaru.net/atom.xml" target="_blank"><img src="/static/img/bottom-rss.png" alt="RSS"></a>
		&nbsp;
		<a href="https://blog.asamaru.net"><span class="word-keep">&copy; 유영재</span></a>
	</div>
</footer>


<div class="scriptHub">
	<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
	<script type="text/javascript" src="https://blog.asamaru.net/static/js/script.js"></script>

	
	
</div>



</body>
</html>
