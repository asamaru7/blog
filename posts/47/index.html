<!DOCTYPE html>
<html>

<head>
	<title>이 세상에 하나는 남기고 가자</title>
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<meta name="author" content="유영재">
	<meta name="keywords" content="이 세상에 하나는 남기고 가자"/>
	<meta name="description" content="세상에 필요한 소스코드 한줄 남기고 가자.
"/>

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- http://opengraphprotocol.org/ -->
	<meta name="twitter:card" content="summary_large_image">
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://blog.asamaru.net/posts/47/">
	<meta property="og:title" content="이 세상에 하나는 남기고 가자">
	<meta property="og:description" content="세상에 필요한 소스코드 한줄 남기고 가자.
">

	<link rel="canonical" href="https://blog.asamaru.net/posts/47/"/>
	<link rel="shortcut icon" type="image/x-icon" media="screen" href="https://blog.asamaru.net/favicon.ico"/>
	<link rel="alternate" type="application/rss+xml" title="이 세상에 하나는 남기고 가자" href="https://blog.asamaru.net/atom.xml"/>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="https://blog.asamaru.net/static/css/style.css"/>
	<link rel="stylesheet" type="text/css" href="https://blog.asamaru.net/static/css/highlight.css"/>

	
	
	<link rel="stylesheet" type="text/css" href="https://blog.asamaru.net/static/css/article-list.css"/>
	

	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
					(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-65749108-2', 'auto');
		ga('send', 'pageview');

	</script>
</head>


<body>
<div class="main">

	<nav class="navbar navbar-default" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" title="toggle navbar" data-toggle="collapse" data-target=".navbar-collapse">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">이 세상에 하나는 남기고 가자</a>
		</div>

		<div class="navbar-collapse collapse">
			
			<ul class="nav navbar-nav">
				<li class="active">
				<a rel="index" href="/">Blog</a>
				</li>
				<li >
				<a href="/archives/">Archives</a>
				</li>
			</ul>
			<ul class="nav navbar-nav navbar-right">
				<li>
					<a class="subscribe-rss" href="https://blog.asamaru.net/atom.xml" title="subscribe via RSS">
						<span class="visible-xs">RSS</span>
						<img class="hidden-xs" src="/static/img/rss.png" alt="RSS">
					</a>
				</li>
			</ul>
			
			<!-- <form class="navbar-form navbar-right" action="http://www.google.co.kr" id="cse-search-box" target="_blank">
			  <div class="form-group">
			    <input type="hidden" name="cx" value="partner-pub-8163803188491150:6044663021" />
			    <input type="hidden" name="ie" value="UTF-8" />
			    <input type="text" name="q" class="form-control" />
			    <input type="submit" name="sa" value="&#xac80;&#xc0c9;" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.co.kr/coop/cse/brand?form=cse-search-box&amp;lang=ko"></script> -->
			<form class="navbar-form navbar-right" action="https://www.google.com/search" method="GET">
				<input type="hidden" name="sitesearch" value="https://blog.asamaru.net">
				<div class="form-group">
					<input class="form-control" type="text" name="q" placeholder="Search">
				</div>
			</form>
			
		</div>
	</div>
</nav>


	<div class="container">
		<div class="row index">
	<div class="content col-lg-9">
		<div>
			<section class="category-slice" post-cate="All">
				
				<article>
					<div class="module">
						<header>
							<a class="title" href="https://blog.asamaru.net/2016/01/20/detect-soft-navigation-bar-availability-in-android-device-progmatically/">
								안드로이드에서 Soft Navigation Bar 검사하기
							</a>
							<p class="post-meta">
								<a href="https://blog.asamaru.net/2016/01/20/detect-soft-navigation-bar-availability-in-android-device-progmatically/">2016.01.20.</span></a>
							</p>
						</header>
						<p>
							<p>안드로이드 기기 중에는 Soft Navigation을 사용하는 것들이 있다. 보통은 뒤로, 메뉴, 홈 버튼 등이 스크린과 분리되어 물리적 버튼으로 구성되어 있으나 이 버튼들이 스크린 하단 영역에 포함되어 있는 경우다. 이런 기기에서는 상황에 딸 하단의 버튼 영역을 숨겨 보다 넓은 공간을 스크린으로 활용할 수 있다.</p>

<p>여기서 다루고자 하는 것은 이런 물리 버튼을 가진 기기와 Soft Navigation을 사용하는 기기를 구분하는 방법이다.</p>

<p>관련 정보를 찾아보면 명확하게 구분할 수 있는 방법을 제시하는 곳을 찾기가 어렵다(안드로이드에서 기기에 관련해서 명확한 구분을 할 수 있는 것을 찾는게 더 빠를지도). 그래서 몇가지를 조사해서 적용한 내용을 남기려고 한다. 이 부분은 현재 테스트할 수 있었던 기기에서만 확인한 정보로 부정확할 수 있음을 양해 바란다(나도 정말 정확한 방법을 찾고 싶다).</p>

<p>우선 아래의 코드를 보자.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">mChildOfContent</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getResources</span><span class="o">().</span><span class="na">getIdentifier</span><span class="o">(</span><span class="s">"config_showNavigationBar"</span><span class="o">,</span> <span class="s">"bool"</span><span class="o">,</span> <span class="s">"android"</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">useSoftNavigation</span> <span class="o">=</span> <span class="n">mChildOfContent</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getResources</span><span class="o">().</span><span class="na">getBoolean</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&lt;</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">ICE_CREAM_SANDWICH</span><span class="o">)</span> <span class="o">{</span>
		<span class="kt">boolean</span> <span class="n">hasBackKey</span> <span class="o">=</span> <span class="n">KeyCharacterMap</span><span class="o">.</span><span class="na">deviceHasKey</span><span class="o">(</span><span class="n">KeyEvent</span><span class="o">.</span><span class="na">KEYCODE_BACK</span><span class="o">);</span>
		<span class="kt">boolean</span> <span class="n">hasHomeKey</span> <span class="o">=</span> <span class="n">KeyCharacterMap</span><span class="o">.</span><span class="na">deviceHasKey</span><span class="o">(</span><span class="n">KeyEvent</span><span class="o">.</span><span class="na">KEYCODE_HOME</span><span class="o">);</span>
		<span class="n">useSoftNavigation</span> <span class="o">=</span> <span class="o">(!(</span><span class="n">hasBackKey</span> <span class="o">&amp;&amp;</span> <span class="n">hasHomeKey</span><span class="o">));</span>
	<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
		<span class="n">useSoftNavigation</span> <span class="o">=</span> <span class="n">ViewConfiguration</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">mChildOfContent</span><span class="o">.</span><span class="na">getContext</span><span class="o">()).</span><span class="na">hasPermanentMenuKey</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>위 코드는 처음에 정리했던 코드다.</p>

<p>1차적으로 <code class="highlighter-rouge">config_showNavigationBar</code> 속성값을 이용해서 사용 유무를 판별한다. 개인적으로 그나마 가장 명시적인 값이라고 생각한다. 문제는 해당 값이 없는 기기가 있다거나 나중에 OS 버전이 올라가면서 속성값이 변경될 우려가 있다는 것이다. 그래서 이 부분을 보완하고자 다른 코드를 덧붙였다.</p>

<p><a href="http://developer.android.com/intl/ko/reference/android/view/ViewConfiguration.html#hasPermanentMenuKey%28%29">hasPermanentMenuKey()</a>를 사용하는 방법도 API 14 이상이라면 유용하다고 생각했으나 부정확했다. 갤럭시 노트 3에서 잘못된 값이 나왔다. 실제로 조사 결과 예상과 다른 값을 반환하는 경우가 다수 있었다(정확하게는 PermanentMenuKey와 Soft Navigation은 직접적인 관련이 없다는 것이 설명이다). 따라서 이 값은 사용이 부적절하다고 보인다.</p>

<p><a href="http://developer.android.com/intl/ko/reference/android/view/KeyCharacterMap.html">KeyCharacterMap</a>를 사용하는 방법은 잘 동작하는 것으로 보이나 정확한 방법이라고는 못하겠다.</p>

<p>그래서 실제 사용하는 코드는 <a href="http://developer.android.com/intl/ko/reference/android/view/ViewConfiguration.html#hasPermanentMenuKey%28%29">hasPermanentMenuKey()</a>를 제외하고 아래와 같이 사용하고 있다(현재까지는).</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kt">boolean</span> <span class="n">useSoftNavigation</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">mChildOfContent</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getResources</span><span class="o">().</span><span class="na">getIdentifier</span><span class="o">(</span><span class="s">"config_showNavigationBar"</span><span class="o">,</span> <span class="s">"bool"</span><span class="o">,</span> <span class="s">"android"</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">useSoftNavigation</span> <span class="o">=</span> <span class="n">mChildOfContent</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getResources</span><span class="o">().</span><span class="na">getBoolean</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
	<span class="kt">boolean</span> <span class="n">hasBackKey</span> <span class="o">=</span> <span class="n">KeyCharacterMap</span><span class="o">.</span><span class="na">deviceHasKey</span><span class="o">(</span><span class="n">KeyEvent</span><span class="o">.</span><span class="na">KEYCODE_BACK</span><span class="o">);</span>
	<span class="kt">boolean</span> <span class="n">hasHomeKey</span> <span class="o">=</span> <span class="n">KeyCharacterMap</span><span class="o">.</span><span class="na">deviceHasKey</span><span class="o">(</span><span class="n">KeyEvent</span><span class="o">.</span><span class="na">KEYCODE_HOME</span><span class="o">);</span>
	<span class="n">useSoftNavigation</span> <span class="o">=</span> <span class="o">(!(</span><span class="n">hasBackKey</span> <span class="o">&amp;&amp;</span> <span class="n">hasHomeKey</span><span class="o">));</span>
<span class="o">}</span>
</code></pre>
</div>

<p>또 다른 방법으로 Screen Size를 이용한 Navigation Bar의 높이를 구하는 방법이 있다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="n">Point</span> <span class="nf">getNavigationBarSize</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Point</span> <span class="n">appUsableSize</span> <span class="o">=</span> <span class="n">getAppUsableScreenSize</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
    <span class="n">Point</span> <span class="n">realScreenSize</span> <span class="o">=</span> <span class="n">getRealScreenSize</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>

    <span class="c1">// navigation bar on the right</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">appUsableSize</span><span class="o">.</span><span class="na">x</span> <span class="o">&lt;</span> <span class="n">realScreenSize</span><span class="o">.</span><span class="na">x</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Point</span><span class="o">(</span><span class="n">realScreenSize</span><span class="o">.</span><span class="na">x</span> <span class="o">-</span> <span class="n">appUsableSize</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">appUsableSize</span><span class="o">.</span><span class="na">y</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// navigation bar at the bottom</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">appUsableSize</span><span class="o">.</span><span class="na">y</span> <span class="o">&lt;</span> <span class="n">realScreenSize</span><span class="o">.</span><span class="na">y</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Point</span><span class="o">(</span><span class="n">appUsableSize</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">realScreenSize</span><span class="o">.</span><span class="na">y</span> <span class="o">-</span> <span class="n">appUsableSize</span><span class="o">.</span><span class="na">y</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// navigation bar is not present</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Point</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="n">Point</span> <span class="nf">getAppUsableScreenSize</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">WindowManager</span> <span class="n">windowManager</span> <span class="o">=</span> <span class="o">(</span><span class="n">WindowManager</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">WINDOW_SERVICE</span><span class="o">);</span>
    <span class="n">Display</span> <span class="n">display</span> <span class="o">=</span> <span class="n">windowManager</span><span class="o">.</span><span class="na">getDefaultDisplay</span><span class="o">();</span>
    <span class="n">Point</span> <span class="n">size</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">();</span>
    <span class="n">display</span><span class="o">.</span><span class="na">getSize</span><span class="o">(</span><span class="n">size</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">size</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="n">Point</span> <span class="nf">getRealScreenSize</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">WindowManager</span> <span class="n">windowManager</span> <span class="o">=</span> <span class="o">(</span><span class="n">WindowManager</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">WINDOW_SERVICE</span><span class="o">);</span>
    <span class="n">Display</span> <span class="n">display</span> <span class="o">=</span> <span class="n">windowManager</span><span class="o">.</span><span class="na">getDefaultDisplay</span><span class="o">();</span>
    <span class="n">Point</span> <span class="n">size</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">();</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="mi">17</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">display</span><span class="o">.</span><span class="na">getRealSize</span><span class="o">(</span><span class="n">size</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="mi">14</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">size</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="o">(</span><span class="n">Integer</span><span class="o">)</span> <span class="n">Display</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="s">"getRawWidth"</span><span class="o">).</span><span class="na">invoke</span><span class="o">(</span><span class="n">display</span><span class="o">);</span>
            <span class="n">size</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="o">(</span><span class="n">Integer</span><span class="o">)</span> <span class="n">Display</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="s">"getRawHeight"</span><span class="o">).</span><span class="na">invoke</span><span class="o">(</span><span class="n">display</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IllegalAccessException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InvocationTargetException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NoSuchMethodException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{}</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="n">size</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>

<p>개인적으로는 스크린 사이즈를 이용하는 방법은 가급적 사용을 피하고 있다. OS 버전이 올라가는 경우와 기기의 다양성을 생각할 때 안정적으로 동작할 것이라는 생각이 들지 않기 때문이다. 하지만 대안이 없다면 사용을 고려하려고 한다.</p>

<p>현재까지는 위 방법으로 필요한 요건을 만족하고 있으니 당분간 지켜볼 예정이다. 항상 그러하듯 안드로이드는 개발이 문제가 아니라 파편화된 상황을 고려하는 작업이 가장 큰 골치거리인 것 같다.</p>

						<!--
							{ % if post.excerpt.size > 32 % }
							{ { post.excerpt } }
							{ % else % }
							{ { post.content | strip_html | strip_newlines | truncate: 160 } }
							{ % endif % }
						-->
						</p>
						
						<footer>
							
                      <span class="word-keep pull-right">
                          <a href="https://blog.asamaru.net/2016/01/20/detect-soft-navigation-bar-availability-in-android-device-progmatically/#post-comment"><span class="glyphicon glyphicon-comment"></span>&nbsp;Comment</a>
                          <a href="https://blog.asamaru.net/2016/01/20/detect-soft-navigation-bar-availability-in-android-device-progmatically/#post-share"><span class="glyphicon glyphicon-heart"></span>&nbsp;Share</a>
                      </span>
						</footer>
					</div>
				</article>
				
			</section>

			<nav class="text-center">
				<ul class="pager">
					
					<li class="previous"><a href="/posts/48">&larr;&nbsp;이전글</a></li>
					
					<li><a href="/archives/">Blog Archives</a></li>
					
					<li class="next"><a href="/posts/46">다음글&nbsp;&rarr;</a></li>
					
				</ul>
			</nav>
		</div>
		<div class="adsense-bottom">
			<!-- adsense -->
			<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<!-- 블로그 하단 -->
			<ins class="adsbygoogle"
				 style="display:block"
				 data-ad-client="ca-pub-8163803188491150"
				 data-ad-slot="7841851420"
				 data-ad-format="auto"></ins>
			<script>
				(adsbygoogle = window.adsbygoogle || []).push({});
			</script>
			<!-- adsense -->
		</div>
	</div>
	<div class="content-navigation col-lg-3">
		<!-- adsense -->
		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<!-- 블로그 우측 -->
		<ins class="adsbygoogle"
			 style="display:block"
			 data-ad-client="ca-pub-8163803188491150"
			 data-ad-slot="1934918622"
			 data-ad-format="auto"></ins>
		<script>
			(adsbygoogle = window.adsbygoogle || []).push({});
		</script>
		<!-- adsense -->
	</div>
</div>


		
	</div>

	<div class="page-scrollTop" data-toggle="tooltip" data-placement="top" title="Top">
		<a href="javascript:void(0);">
			<div class="arrow"></div>
			<div class="stick"></div>
		</a>
	</div>
</div>

<footer class="footnote footnote-tiffany">
	<div class="container">
		<a class="foot-item" href="mailto:asamaru@asamaru.net" target="_blank"><img src="/static/img/bottom-email.png" alt="Email"></a>
		<a class="foot-item" href="https://github.com/asamaru7" target="_blank"><img src="/static/img/bottom-github.png" alt="Github"></a>
		<a class="foot-item" href="https://blog.asamaru.net/atom.xml" target="_blank"><img src="/static/img/bottom-rss.png" alt="RSS"></a>
		&nbsp;
		<a href="https://blog.asamaru.net"><span class="word-keep">&copy; 유영재</span></a>
	</div>
</footer>


<div class="scriptHub">
	<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
	<script type="text/javascript" src="https://blog.asamaru.net/static/js/script.js"></script>

	
	
</div>



</body>
</html>
